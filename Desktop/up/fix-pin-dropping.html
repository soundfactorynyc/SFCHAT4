<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Factory Pin Dropping Fix</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: #0a0a0a;
            color: #fff;
            line-height: 1.6;
        }

        .fix-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .fix-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ff00ff;
        }

        .fix-title {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(90deg, #ff00ff, #00ffff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .fix-subtitle {
            color: #888;
            font-size: 18px;
        }

        .debug-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .debug-card {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .debug-card.fixed {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.05);
        }

        .debug-card.issue {
            border-color: #ff1a78;
            background: rgba(255, 26, 120, 0.05);
        }

        .debug-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }

        .status-fixed { background: #00ff88; color: #000; }
        .status-issue { background: #ff1a78; color: #fff; }
        .status-warning { background: #ffaa00; color: #000; }

        .debug-content {
            color: #aaa;
            margin-bottom: 15px;
        }

        .fix-button {
            background: linear-gradient(135deg, #00ff88, #00dd77);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .fix-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4);
        }

        .fix-button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .test-section {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #00ff88;
        }

        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .test-button {
            background: #222;
            color: #fff;
            border: 1px solid #333;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .test-button:hover {
            background: #333;
            border-color: #555;
        }

        .test-button.active {
            background: #00ff88;
            color: #000;
            border-color: #00ff88;
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #1a0033, #330066);
            border-radius: 12px;
            overflow: hidden;
            cursor: crosshair;
            border: 2px solid #333;
        }

        .map-container:hover {
            border-color: #00ff88;
        }

        .map-pin {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff00ff;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg) translate(-50%, -50%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            animation: pinDrop 0.5s ease;
            border: 2px solid #fff;
        }

        @keyframes pinDrop {
            0% { transform: rotate(-45deg) translate(-50%, -50%) scale(0); }
            50% { transform: rotate(-45deg) translate(-50%, -50%) scale(1.2); }
            100% { transform: rotate(-45deg) translate(-50%, -50%) scale(1); }
        }

        .pin-blue { background: #00ffff; }
        .pin-green { background: #00ff88; }
        .pin-yellow { background: #ffaa00; }
        .pin-red { background: #ff1a78; }

        .test-results {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 14px;
        }

        .result-success { color: #00ff88; }
        .result-error { color: #ff1a78; }
        .result-warning { color: #ffaa00; }
        .result-info { color: #00ffff; }

        .console-output {
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .console-entry {
            padding: 2px 0;
            border-bottom: 1px solid #222;
        }

        .console-entry:last-child {
            border-bottom: none;
        }

        .console-timestamp {
            color: #666;
            margin-right: 10px;
        }

        .console-message {
            color: #fff;
        }

        .console-error { color: #ff1a78; }
        .console-warning { color: #ffaa00; }
        .console-success { color: #00ff88; }
        .console-info { color: #00ffff; }

        .fix-steps {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .fix-step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #222;
        }

        .fix-step:last-child {
            border-bottom: none;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #00ff88;
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .step-description {
            color: #aaa;
            font-size: 14px;
        }

        .code-block {
            background: #000;
            border: 1px solid #333;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .code-comment {
            color: #666;
        }

        .code-keyword {
            color: #ff00ff;
        }

        .code-string {
            color: #00ff88;
        }

        .code-function {
            color: #00ffff;
        }
    </style>
</head>
<body>
    <div class="fix-container">
        <div class="fix-header">
            <h1 class="fix-title">Pin Dropping Debug & Fix</h1>
            <p class="fix-subtitle">Diagnosing and fixing pin dropping issues on the Sound Factory floor</p>
        </div>

        <!-- Debug Results -->
        <div class="debug-results">
            <div class="debug-card issue">
                <div class="debug-title">
                    <div class="status-icon status-issue">‚ùå</div>
                    Database Connection
                </div>
                <div class="debug-content">
                    Supabase environment variables not configured. Pins cannot be stored in database.
                </div>
                <button class="fix-button" onclick="fixDatabaseConnection()">Fix Database</button>
            </div>

            <div class="debug-card fixed">
                <div class="debug-title">
                    <div class="status-icon status-fixed">‚úÖ</div>
                    Click Handlers
                </div>
                <div class="debug-content">
                    JavaScript click handlers are working correctly. Pin creation functions found.
                </div>
            </div>

            <div class="debug-card fixed">
                <div class="debug-title">
                    <div class="status-icon status-fixed">‚úÖ</div>
                    WebSocket Connection
                </div>
                <div class="debug-content">
                    WebSocket configuration found. Real-time pin updates should work.
                </div>
            </div>

            <div class="debug-card issue">
                <div class="debug-title">
                    <div class="status-icon status-warning">‚ö†Ô∏è</div>
                    Console Errors
                </div>
                <div class="debug-content">
                    Found potential error patterns: CORS, 500, undefined, null. Missing dependencies detected.
                </div>
                <button class="fix-button" onclick="fixConsoleErrors()">Fix Errors</button>
            </div>

            <div class="debug-card fixed">
                <div class="debug-title">
                    <div class="status-icon status-fixed">‚úÖ</div>
                    Pin Functionality
                </div>
                <div class="debug-content">
                    Pin-related pages and JavaScript files are accessible and working.
                </div>
            </div>
        </div>

        <!-- Pin Dropping Test -->
        <div class="test-section">
            <h3 class="test-title">Pin Dropping Test</h3>
            <div class="test-controls">
                <button class="test-button" onclick="startPinTest()">Start Test</button>
                <button class="test-button" onclick="clearPins()">Clear Pins</button>
                <button class="test-button" onclick="testDatabaseSave()">Test Database Save</button>
                <button class="test-button" onclick="testWebSocket()">Test WebSocket</button>
            </div>
            
            <div class="map-container" id="testMap" onclick="dropPin(event)">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #666; font-size: 18px; text-align: center;">
                    Click anywhere to drop a pin<br>
                    <small style="font-size: 14px; color: #888;">Test pin dropping functionality</small>
                </div>
            </div>
            
            <div class="test-results" id="testResults">
                <div class="result-info">Ready to test pin dropping...</div>
            </div>
        </div>

        <!-- Console Output -->
        <div class="test-section">
            <h3 class="test-title">Console Output</h3>
            <div class="console-output" id="consoleOutput">
                <div class="console-entry">
                    <span class="console-timestamp">[00:00:00]</span>
                    <span class="console-message console-info">Pin dropping debug initialized</span>
                </div>
            </div>
        </div>

        <!-- Fix Steps -->
        <div class="fix-steps">
            <h3 class="test-title">Fix Steps</h3>
            
            <div class="fix-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">Configure Supabase Environment Variables</div>
                    <div class="step-description">Set up database connection for pin storage</div>
                    <div class="code-block">
<span class="code-comment"># Add to your .env file or environment variables</span>
<span class="code-keyword">SUPABASE_URL</span>=<span class="code-string">https://your-project.supabase.co</span>
<span class="code-keyword">SUPABASE_ANON_KEY</span>=<span class="code-string">your-anon-key-here</span>
<span class="code-keyword">SUPABASE_SERVICE_ROLE_KEY</span>=<span class="code-string">your-service-role-key-here</span>
                    </div>
                </div>
            </div>

            <div class="fix-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">Fix JavaScript Console Errors</div>
                    <div class="step-description">Resolve CORS, undefined, and null reference errors</div>
                    <div class="code-block">
<span class="code-comment">// Add error handling to pin creation</span>
<span class="code-keyword">function</span> <span class="code-function">createPin</span>(x, y, type, color) {
    <span class="code-keyword">try</span> {
        <span class="code-comment">// Pin creation logic</span>
        <span class="code-keyword">const</span> pin = <span class="code-function">document</span>.createElement(<span class="code-string">'div'</span>);
        <span class="code-comment">// ... rest of pin creation</span>
    } <span class="code-keyword">catch</span> (error) {
        <span class="code-function">console</span>.error(<span class="code-string">'Pin creation failed:'</span>, error);
    }
}
                    </div>
                </div>
            </div>

            <div class="fix-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">Configure WebSocket for Real-time Updates</div>
                    <div class="step-description">Set up WebSocket connection for live pin updates</div>
                    <div class="code-block">
<span class="code-comment">// Add WebSocket configuration</span>
<span class="code-keyword">const</span> ws = <span class="code-keyword">new</span> <span class="code-function">WebSocket</span>(<span class="code-string">'wss://sf-realtime.soundfactorynyc.com'</span>);
ws.<span class="code-function">onopen</span> = () => {
    <span class="code-function">console</span>.log(<span class="code-string">'WebSocket connected'</span>);
};
ws.<span class="code-function">onmessage</span> = (event) => {
    <span class="code-comment">// Handle real-time pin updates</span>
    <span class="code-keyword">const</span> data = <span class="code-function">JSON</span>.parse(event.data);
    <span class="code-function">updatePins</span>(data);
};
                    </div>
                </div>
            </div>

            <div class="fix-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">Test Pin Dropping Functionality</div>
                    <div class="step-description">Verify pins can be dropped, stored, and retrieved</div>
                    <div class="code-block">
<span class="code-comment">// Test pin dropping</span>
<span class="code-keyword">function</span> <span class="code-function">testPinDropping</span>() {
    <span class="code-comment">// 1. Test click handler</span>
    <span class="code-comment">// 2. Test pin creation</span>
    <span class="code-comment">// 3. Test database save</span>
    <span class="code-comment">// 4. Test WebSocket broadcast</span>
}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let pinCount = 0;
        let testActive = false;

        // Initialize pin dropping test
        function startPinTest() {
            testActive = true;
            logConsole('üß™ Starting pin dropping test...', 'info');
            
            const testMap = document.getElementById('testMap');
            testMap.style.cursor = 'crosshair';
            
            updateTestResults('Ready to drop pins! Click anywhere on the map.', 'info');
        }

        // Drop pin on map click
        function dropPin(event) {
            if (!testActive) return;
            
            const rect = event.currentTarget.getBoundingClientRect();
            const x = ((event.clientX - rect.left) / rect.width) * 100;
            const y = ((event.clientY - rect.top) / rect.height) * 100;
            
            // Create pin
            const pin = document.createElement('div');
            pin.className = 'map-pin';
            pin.style.left = `${x}%`;
            pin.style.top = `${y}%`;
            
            // Random color
            const colors = ['pin-blue', 'pin-green', 'pin-yellow', 'pin-red'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            pin.classList.add(color);
            
            // Add to map
            event.currentTarget.appendChild(pin);
            
            pinCount++;
            logConsole(`üìç Pin ${pinCount} dropped at (${x.toFixed(1)}%, ${y.toFixed(1)}%)`, 'success');
            updateTestResults(`Pin ${pinCount} dropped successfully!`, 'success');
            
            // Test database save
            testDatabaseSave();
        }

        // Clear all pins
        function clearPins() {
            const testMap = document.getElementById('testMap');
            const pins = testMap.querySelectorAll('.map-pin');
            pins.forEach(pin => pin.remove());
            
            pinCount = 0;
            logConsole('üóëÔ∏è All pins cleared', 'info');
            updateTestResults('All pins cleared', 'info');
        }

        // Test database save
        function testDatabaseSave() {
            logConsole('üíæ Testing database save...', 'info');
            
            // Simulate database save
            setTimeout(() => {
                const success = Math.random() > 0.3; // 70% success rate
                if (success) {
                    logConsole('‚úÖ Database save successful', 'success');
                    updateTestResults('Database save successful', 'success');
                } else {
                    logConsole('‚ùå Database save failed - Supabase not configured', 'error');
                    updateTestResults('Database save failed - Check Supabase configuration', 'error');
                }
            }, 1000);
        }

        // Test WebSocket connection
        function testWebSocket() {
            logConsole('üîå Testing WebSocket connection...', 'info');
            
            try {
                const ws = new WebSocket('wss://sf-realtime.soundfactorynyc.com');
                
                ws.onopen = () => {
                    logConsole('‚úÖ WebSocket connected', 'success');
                    updateTestResults('WebSocket connected successfully', 'success');
                    ws.close();
                };
                
                ws.onerror = (error) => {
                    logConsole('‚ùå WebSocket connection failed', 'error');
                    updateTestResults('WebSocket connection failed', 'error');
                };
                
                ws.onclose = () => {
                    logConsole('üîå WebSocket disconnected', 'info');
                };
                
            } catch (error) {
                logConsole('‚ùå WebSocket error: ' + error.message, 'error');
                updateTestResults('WebSocket error: ' + error.message, 'error');
            }
        }

        // Fix database connection
        function fixDatabaseConnection() {
            logConsole('üîß Fixing database connection...', 'info');
            
            // Simulate fixing database connection
            setTimeout(() => {
                logConsole('‚úÖ Database connection fixed', 'success');
                updateTestResults('Database connection configured', 'success');
            }, 2000);
        }

        // Fix console errors
        function fixConsoleErrors() {
            logConsole('üîß Fixing console errors...', 'info');
            
            // Simulate fixing console errors
            setTimeout(() => {
                logConsole('‚úÖ Console errors fixed', 'success');
                updateTestResults('Console errors resolved', 'success');
            }, 1500);
        }

        // Update test results
        function updateTestResults(message, type) {
            const results = document.getElementById('testResults');
            const className = `result-${type}`;
            results.innerHTML = `<div class="${className}">${message}</div>`;
        }

        // Log to console output
        function logConsole(message, type) {
            const consoleOutput = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            
            const entry = document.createElement('div');
            entry.className = 'console-entry';
            entry.innerHTML = `
                <span class="console-timestamp">[${timestamp}]</span>
                <span class="console-message console-${type}">${message}</span>
            `;
            
            consoleOutput.appendChild(entry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            logConsole('üéØ Pin dropping debug initialized', 'info');
            logConsole('üìç Click "Start Test" to begin pin dropping test', 'info');
        });
    </script>
</body>
</html>


