<!DOCTYPE html>
<html>
<head>
    <title>Backend Livestream Control - Sound Factory</title>
    <style>
        body {
            background: #111;
            color: white;
            font-family: Arial;
            margin: 0;
            padding: 20px;
        }
        
        .control-panel {
            max-width: 800px;
            margin: 0 auto;
            background: #222;
            border: 2px solid #ff0066;
            border-radius: 10px;
            padding: 30px;
        }
        
        h1 {
            color: #ff0066;
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
        }
        
        .stream-section {
            background: #333;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #00ffff;
        }
        
        .stream-section h2 {
            color: #00ffff;
            margin-top: 0;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }
        
        .btn-live {
            background: #ff0000;
            color: white;
        }
        
        .btn-stop {
            background: #666;
            color: white;
        }
        
        .btn-youtube {
            background: #ff0000;
            color: white;
        }
        
        .btn-twitch {
            background: #9146ff;
            color: white;
        }
        
        .btn-direct {
            background: #0099ff;
            color: white;
        }
        
        .btn:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
        }
        
        .stream-url {
            width: 100%;
            padding: 10px;
            background: #444;
            border: 1px solid #666;
            color: white;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.offline {
            background: rgba(255,0,0,0.2);
            border: 1px solid #ff0000;
            color: #ff6666;
        }
        
        .status.live {
            background: rgba(0,255,0,0.2);
            border: 1px solid #00ff00;
            color: #66ff66;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .obs-info {
            background: rgba(255,255,0,0.1);
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ffff00;
            margin: 20px 0;
        }
        
        .obs-info h3 {
            color: #ffff00;
            margin-top: 0;
        }
        
        .rtmp-settings {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>

<div class="control-panel">
    <h1>üéõÔ∏è BACKEND LIVESTREAM CONTROL</h1>
    
    <!-- STREAM STATUS -->
    <div class="stream-section">
        <h2>üì° Stream Status</h2>
        <div id="streamStatus" class="status offline">
            ‚ö´ OFFLINE
        </div>
        <div class="controls">
            <button class="btn btn-live" onclick="goLive()">üî¥ GO LIVE</button>
            <button class="btn btn-stop" onclick="stopStream()">‚èπÔ∏è STOP STREAM</button>
        </div>
    </div>
    
    <!-- STREAM PLATFORMS -->
    <div class="stream-section">
        <h2>üì∫ Stream Platforms</h2>
        <div class="controls">
            <button class="btn btn-youtube" onclick="setupYouTube()">üì∫ YOUTUBE</button>
            <button class="btn btn-twitch" onclick="setupTwitch()">üéÆ TWITCH</button>
            <button class="btn btn-direct" onclick="setupDirect()">üé• DIRECT RTMP</button>
        </div>
        
        <div id="platformSettings" style="display:none;">
            <input type="text" id="streamKey" class="stream-url" placeholder="Enter Stream Key">
            <button class="btn" onclick="saveSettings()" style="background:#00ff00; color:black;">üíæ SAVE</button>
        </div>
    </div>
    
    <!-- OBS SETTINGS -->
    <div class="obs-info">
        <h3>üé¨ OBS SETUP FOR seance.soundfactorynyc.com</h3>
        <div class="rtmp-settings">
            <strong>RTMP Server:</strong> rtmp://live.twitch.tv/live<br>
            <strong>Stream Key:</strong> [Your Key Here]<br>
            <strong>Encoder:</strong> x264<br>
            <strong>Bitrate:</strong> 3500 Kbps<br>
            <strong>Resolution:</strong> 1920x1080<br>
            <strong>FPS:</strong> 30
        </div>
        <p>üí° <strong>Tip:</strong> Add this page as a Browser Source in OBS to control stream from within OBS!</p>
    </div>
    
    <!-- DIRECT STREAMING -->
    <div class="stream-section">
        <h2>üé• Direct Stream to Your Site</h2>
        <p>Stream directly to seance.soundfactorynyc.com visitors:</p>
        <input type="text" id="directUrl" class="stream-url" placeholder="Enter HLS Stream URL (.m3u8)" value="">
        <div class="controls">
            <button class="btn btn-direct" onclick="startDirectStream()">‚ñ∂Ô∏è START DIRECT</button>
            <button class="btn btn-stop" onclick="stopDirectStream()">‚èπÔ∏è STOP DIRECT</button>
        </div>
    </div>
    
    <!-- VIEWER STATS -->
    <div class="stream-section">
        <h2>üë• Live Stats</h2>
        <div style="display: flex; gap: 30px; font-size: 18px;">
            <div>
                <strong style="color: #00ffff;">Viewers:</strong> 
                <span id="viewerCount">0</span>
            </div>
            <div>
                <strong style="color: #ff0066;">Duration:</strong> 
                <span id="streamDuration">00:00:00</span>
            </div>
            <div>
                <strong style="color: #ffff00;">Quality:</strong> 
                <span id="streamQuality">1080p</span>
            </div>
        </div>
    </div>
    
    <!-- TICKETS (admin) -->
    <div class="stream-section">
      <h2>üéüÔ∏è Ticket Link (Admin)</h2>
      <input class="stream-url" id="ticketCanonical" value="https://soundfactory.ticketspice.com/soundfactory-sance" readonly />
      <div class="controls">
        <button class="btn" onclick="copyTicket()">üìã Copy Link</button>
        <a class="btn btn-direct" href="https://soundfactory.ticketspice.com/soundfactory-sance" target="_blank" rel="noopener">üîó Open</a>
        <button class="btn btn-stop" onclick="if(window.__fixTickets){window.__fixTickets();alert('Ticket anchors fixed on this page');}">üõ†Ô∏è Fix Anchors (this page)</button>
      </div>
    </div>
</div>

<script src="./ticket-link-guard.js"></script>
<script>
let isLive = false;
let startTime = null;
let platform = '';

// GO LIVE
function goLive() {
    isLive = true;
    startTime = new Date();
    
    const status = document.getElementById('streamStatus');
    status.className = 'status live';
    status.innerHTML = 'üî¥ LIVE';
    
    startStatsUpdate();
    alert('üéâ YOU ARE NOW LIVE!');
}

// STOP STREAM
function stopStream() {
    isLive = false;
    startTime = null;
    
    const status = document.getElementById('streamStatus');
    status.className = 'status offline';
    status.innerHTML = '‚ö´ OFFLINE';
    
    alert('üì¥ Stream Stopped');
}

// PLATFORM SETUPS
function setupYouTube() {
    platform = 'YouTube';
    document.getElementById('platformSettings').style.display = 'block';
    document.getElementById('streamKey').placeholder = 'Enter YouTube Stream Key';
}

function setupTwitch() {
    platform = 'Twitch';
    document.getElementById('platformSettings').style.display = 'block';
    document.getElementById('streamKey').placeholder = 'Enter Twitch Stream Key';
}

function setupDirect() {
    platform = 'Direct';
    document.getElementById('platformSettings').style.display = 'block';
    document.getElementById('streamKey').placeholder = 'Enter RTMP Server URL';
}

function saveSettings() {
    const key = document.getElementById('streamKey').value;
    if(key) {
        alert(`‚úÖ ${platform} settings saved!`);
        document.getElementById('platformSettings').style.display = 'none';
    }
}

// DIRECT STREAMING TO YOUR SITE
function startDirectStream() {
    const url = document.getElementById('directUrl').value;
    if(url) {
        // This would connect to your site's streaming system
        alert(`üé• Direct stream started!\nURL: ${url}`);
        goLive();
    } else {
        alert('‚ùå Please enter a stream URL');
    }
}

function stopDirectStream() {
    alert('üì¥ Direct stream stopped');
    stopStream();
}

// UPDATE STATS
function startStatsUpdate() {
    if(!isLive) return;
    
    // Simulate viewer count
    const viewers = Math.floor(Math.random() * 100) + 10;
    document.getElementById('viewerCount').textContent = viewers;
    
    // Update duration
    if(startTime) {
        const now = new Date();
        const diff = now - startTime;
        const hours = Math.floor(diff / 3600000).toString().padStart(2, '0');
        const minutes = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
        const seconds = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
        document.getElementById('streamDuration').textContent = `${hours}:${minutes}:${seconds}`;
    }
    
    setTimeout(startStatsUpdate, 1000);
}

// Initialize
document.getElementById('viewerCount').textContent = '0';
document.getElementById('streamDuration').textContent = '00:00:00';

function copyTicket(){
  const el = document.getElementById('ticketCanonical');
  el.select(); el.setSelectionRange(0, 99999);
  try { document.execCommand('copy'); } catch(e){}
}
</script>

</body>
</html>