<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Promoter Dashboard - Sound Factory</title>
<meta name="color-scheme" content="dark" />
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<style>
:root{
  --bg:#000000;
  --surface:#0a0a0a;
  --border:#333333;
  --text:#ffffff;
  --muted:#999999;
  --accent:#ffffff;
  --gray-light:#cccccc;
  --gray-medium:#666666;
  --gray-dark:#1a1a1a;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;margin:0;padding:0}
body{
  background:#000000;
  color:#ffffff;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Helvetica,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  font-feature-settings:"kern" 1;
  text-rendering:optimizeLegibility;
  padding:20px;
  min-height:100vh;
}

.header{
  background:#0a0a0a;
  border:0.5px solid rgba(255,255,255,0.15);
  border-radius:2px;
  padding:24px;
  margin-bottom:24px;
}

.header-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

.logo-wrapper{
  display:flex;
  align-items:center;
  gap:16px;
}

.logo{
  height:60px;
  width:auto;
}

.header h1{
  font-size:18px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:0.3px;
}

.header .promoter-badge{
  background:rgba(255,255,255,0.05);
  border:0.5px solid rgba(255,255,255,0.15);
  color:#cccccc;
  padding:6px 12px;
  border-radius:2px;
  font-size:11px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:1.5px;
}

.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:16px;
  margin-bottom:32px;
}

.stat-card{
  background:#0a0a0a;
  border:0.5px solid rgba(255,255,255,0.15);
  border-radius:2px;
  padding:20px;
}

.stat-label{
  color:#999999;
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:2px;
  margin-bottom:8px;
  font-weight:700;
}

.stat-value{
  font-size:32px;
  font-weight:300;
  margin-bottom:4px;
  color:#ffffff;
}

.stat-change{
  font-size:11px;
  color:#666666;
  letter-spacing:0.2px;
}

.main-content{
  display:grid;
  grid-template-columns:1fr 400px;
  gap:24px;
}

.data-table{
  background:#0a0a0a;
  border:0.5px solid rgba(255,255,255,0.15);
  border-radius:2px;
  overflow:hidden;
}

.table-header{
  background:rgba(255,255,255,0.02);
  padding:16px 20px;
  border-bottom:0.5px solid rgba(255,255,255,0.15);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.table-title{
  font-size:13px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:1.5px;
}

.table-actions{
  display:flex;
  gap:8px;
}

.btn{
  background:#111111;
  border:0.5px solid rgba(255,255,255,0.15);
  color:#ffffff;
  padding:0;
  height:28px;
  padding:0 12px;
  border-radius:2px;
  font-size:11px;
  font-weight:700;
  cursor:pointer;
  transition:all 0.2s;
  text-transform:uppercase;
  letter-spacing:1.5px;
}

.btn:hover{
  background:#1a1a1a;
  border-color:rgba(255,255,255,0.4);
}

.btn-primary{
  background:#111111;
  color:#ffffff;
  border:1px solid #222222;
}

.btn-primary:hover{
  background:#1a1a1a;
  border-color:#333333;
}

table{
  width:100%;
  border-collapse:collapse;
}

thead{
  background:rgba(0,0,0,0.3);
}

th{
  text-align:left;
  padding:8px 12px;
  font-size:11px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:1px;
  color:#999999;
  border-bottom:0.5px solid rgba(255,255,255,0.1);
}

td{
  padding:12px;
  font-size:12px;
  border-bottom:0.5px solid rgba(255,255,255,0.05);
  color:#F0F0F0;
  letter-spacing:0.2px;
}

tbody tr:hover{
  background:rgba(255,255,255,0.02);
}

.sidebar{
  display:flex;
  flex-direction:column;
  gap:16px;
}

.activity-feed{
  background:#0a0a0a;
  border:0.5px solid rgba(255,255,255,0.15);
  border-radius:2px;
  padding:20px;
  max-height:400px;
  overflow-y:auto;
}

.activity-item{
  display:flex;
  gap:12px;
  margin-bottom:16px;
  padding-bottom:16px;
  border-bottom:0.5px solid rgba(255,255,255,0.05);
}

.activity-item:last-child{
  border-bottom:none;
  margin-bottom:0;
  padding-bottom:0;
}

.activity-icon{
  width:32px;
  height:32px;
  background:rgba(255,255,255,0.05);
  border-radius:2px;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
  font-size:14px;
}

.activity-content{
  flex:1;
}

.activity-title{
  font-size:12px;
  margin-bottom:2px;
  color:#F0F0F0;
  letter-spacing:0.2px;
}

.activity-time{
  font-size:11px;
  color:#999999;
}

input[type="text"]{
  width:100%;
  padding:8px 12px;
  border-radius:2px;
  background:rgba(255,255,255,0.05);
  border:0.5px solid rgba(255,255,255,0.15);
  color:#F0F0F0;
  font-size:12px;
  height:28px;
  transition:all 0.2s;
  font-weight:400;
  letter-spacing:0.2px;
}

input[type="text"]::placeholder{
  color:#666666;
}

input[type="text"]:focus{
  outline:none;
  border-color:rgba(255,255,255,0.4);
  background:rgba(255,255,255,0.08);
}

.form-group{
  margin-bottom:16px;
}

.form-label{
  display:block;
  font-size:11px;
  color:#cccccc;
  text-transform:uppercase;
  margin-bottom:6px;
  letter-spacing:2px;
  font-weight:700;
}

/* Leaflet overrides for dark theme */
.leaflet-container{
  background:#000;
  font-family:inherit;
}

.leaflet-popup-content-wrapper{
  background:rgba(0,0,0,0.95);
  border:0.5px solid rgba(255,255,255,0.3);
  border-radius:2px;
  color:#fff;
}

.leaflet-popup-tip{
  background:rgba(0,0,0,0.95);
}

.leaflet-control-attribution{
  background:rgba(0,0,0,0.8) !important;
  color:#666 !important;
  font-size:9px !important;
}

.leaflet-control-attribution a{
  color:#999 !important;
}

/* Custom marker pulse animation */
@keyframes marker-pulse{
  0%{
    box-shadow:0 0 0 0 rgba(76,175,80,0.7);
  }
  70%{
    box-shadow:0 0 0 10px rgba(76,175,80,0);
  }
  100%{
    box-shadow:0 0 0 0 rgba(76,175,80,0);
  }
}

@media (max-width:1024px){
  .main-content{
    grid-template-columns:1fr;
  }
  .stats-grid{
    grid-template-columns:repeat(2,1fr);
  }
}

@media (max-width:640px){
  .stats-grid{
    grid-template-columns:1fr;
  }
  .header{
    flex-direction:column;
    gap:12px;
  }
}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-top">
    <div class="logo-wrapper">
      <img src="sf-logo.png" alt="Sound Factory" class="logo" />
      <div>
        <h1>Promoter Dashboard</h1>
        <p style="color:#666;font-size:13px;margin-top:4px;">Sound Factory NYC - Jonathan Peters Productions</p>
      </div>
    </div>
    <div class="promoter-badge" id="promoBadge">Loading...</div>
  </div>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-label">Total Promoters</div>
    <div class="stat-value" id="totalPromoters">1</div>
    <div class="stat-change">+1 this week</div>
  </div>
  
  <div class="stat-card">
    <div class="stat-label">Total Sales</div>
    <div class="stat-value" id="totalSales">$0</div>
    <div class="stat-change">Ready for sales</div>
  </div>
  
  <div class="stat-card">
    <div class="stat-label">Commissions Earned</div>
    <div class="stat-value" id="totalCommissions">$0</div>
    <div class="stat-change">Auto-tracked</div>
  </div>
  
  <div class="stat-card">
    <div class="stat-label">Active Promo Codes</div>
    <div class="stat-value" id="activePromoCodes">1</div>
    <div class="stat-change">All tracked</div>
  </div>
</div>

<!-- Main Content -->
<div class="main-content">
  <!-- Promoters Table -->
  <div class="data-table">
    <div class="table-header">
      <div class="table-title">All Promoters</div>
      <div class="table-actions">
        <button class="btn" onclick="exportData()">Export CSV</button>
        <button class="btn btn-primary" onclick="refreshData()">Refresh</button>
      </div>
    </div>
    
    <div style="padding:16px;">
      <input type="text" class="search-box" placeholder="Search by name, email, phone, or promo code..." id="searchBox" onkeyup="searchPromoters()" />
      
      <div class="tabs">
        <button class="tab active" onclick="filterPromoters('all', this)">All</button>
        <button class="tab" onclick="filterPromoters('approved', this)">Approved</button>
        <button class="tab" onclick="filterPromoters('pending', this)">Pending</button>
        <button class="tab" onclick="filterPromoters('suspended', this)">Suspended</button>
      </div>
    </div>
    
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Promo Code</th>
          <th>Status</th>
          <th>Commission</th>
          <th>Sales</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="promotersTable">
        <!-- Data will be loaded here -->
      </tbody>
    </table>
  </div>
  
  <!-- Sidebar -->
  <div class="sidebar">
    <!-- Sales Map -->
    <div class="activity-feed">
      <h3 style="font-size:14px;margin-bottom:16px;">üó∫Ô∏è Sales Map</h3>
      <div id="salesMap" style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.1);border-radius:2px;height:280px;position:relative;overflow:hidden;">
        <!-- Leaflet Map Container -->
        <div id="mapContainer" style="width:100%;height:100%;"></div>
        
        <!-- Map Legend -->
        <div style="position:absolute;bottom:8px;left:8px;background:rgba(0,0,0,0.9);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;padding:8px;font-size:10px;z-index:1000;">
          <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px;">
            <div style="width:8px;height:8px;background:#4caf50;border-radius:50%;"></div>
            <span style="color:#999;">1-3 sales</span>
          </div>
          <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px;">
            <div style="width:10px;height:10px;background:#ff9800;border-radius:50%;"></div>
            <span style="color:#999;">4-10 sales</span>
          </div>
          <div style="display:flex;align-items:center;gap:6px;">
            <div style="width:12px;height:12px;background:#f44336;border-radius:50%;"></div>
            <span style="color:#999;">10+ sales</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Recent Sales Activity -->
    <div class="activity-feed">
      <h3 style="font-size:14px;margin-bottom:16px;">Recent Sales</h3>
      <div id="recentSales">
        <div class="activity-item">
          <div class="activity-icon">‚è∞</div>
          <div class="activity-content">
            <div class="activity-title">No sales yet</div>
            <div class="activity-time">Waiting for first sale</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Promo Code Tracking -->
    <div class="activity-feed">
      <h3 style="font-size:14px;margin-bottom:16px;">Active Promo Codes</h3>
      <div id="promoCodeUsage">
        <!-- Will be populated -->
      </div>
    </div>
    
    <!-- Unattributed Sales Alert -->
    <div class="activity-feed" style="border-color:rgba(255,193,7,0.2);">
      <h3 style="font-size:14px;margin-bottom:16px;color:#FFC107;">Unattributed Sales</h3>
      <div id="unattributedSales">
        <div class="activity-item">
          <div class="activity-icon">‚úÖ</div>
          <div class="activity-content">
            <div class="activity-title">All sales tracked</div>
            <div class="activity-time">No unattributed sales</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- AI PROMOTIONAL KIT DASHBOARD -->
<section style="margin-top:32px;background:linear-gradient(135deg, rgba(103,114,229,0.05) 0%, rgba(255,255,255,0.02) 100%);border:0.5px solid rgba(103,114,229,0.3);border-radius:2px;padding:24px;box-shadow:0 8px 32px rgba(103,114,229,0.1);position:relative;overflow:hidden;" id="ai-kit">
  <!-- Animated Background Pattern -->
  <div style="position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 20% 50%, rgba(103,114,229,0.03) 0%, transparent 50%),radial-gradient(circle at 80% 50%, rgba(255,107,107,0.03) 0%, transparent 50%);opacity:0.5;pointer-events:none;animation:pulseGlow 8s ease-in-out infinite;"></div>
  
  <div style="position:relative;z-index:1;">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
      <div style="font-size:24px;animation:rotate360 20s linear infinite;">üé®</div>
      <h2 style="font-size:18px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;background:linear-gradient(135deg, #6772e5 0%, #ff6b6b 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">AI Promotional Kit Dashboard</h2>
    </div>
    <p style="font-size:12px;color:#999;margin-bottom:24px;">‚ö° Customize your promo links and generate platform-ready captions, hashtags, and wild text variations in seconds.</p>
  </div>

  <!-- AI Grid -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
    <!-- Left: Inputs -->
    <div style="display:flex;flex-direction:column;gap:12px;background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;padding:16px;">
      <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
        <label for="aiPromo" style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;">Your Promo Code</label>
        <input id="aiPromo" type="text" placeholder="YOURNAME_123" readonly style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.1);border-radius:2px;color:#999;font-size:12px;padding:10px 12px;font-family:inherit;cursor:not-allowed;">
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
        <label for="aiEventName" style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;">Event</label>
        <input id="aiEventName" type="text" placeholder="Sound Factory S√©ance ‚Äî Halloween" readonly style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.1);border-radius:2px;color:#999;font-size:12px;padding:10px 12px;font-family:inherit;cursor:not-allowed;">
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
        <label for="aiEventDate" style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;">Date</label>
        <input id="aiEventDate" type="text" placeholder="Nov 1, New York City" readonly style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.1);border-radius:2px;color:#999;font-size:12px;padding:10px 12px;font-family:inherit;cursor:not-allowed;">
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
        <label for="aiBaseUrl" style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;">Base Link</label>
        <input id="aiBaseUrl" type="text" value="https://soundfactorynyc.com/halloween" readonly style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.1);border-radius:2px;color:#999;font-size:12px;padding:10px 12px;font-family:inherit;cursor:not-allowed;">
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
        <label style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;">Platforms</label>
        <div style="display:flex;flex-wrap:wrap;gap:10px;">
          <label style="font-size:11px;color:#cfcfcf;"><input type="checkbox" class="aiPlatform" value="Instagram" checked> Instagram</label>
          <label style="font-size:11px;color:#cfcfcf;"><input type="checkbox" class="aiPlatform" value="TikTok" checked> TikTok</label>
          <label style="font-size:11px;color:#cfcfcf;"><input type="checkbox" class="aiPlatform" value="Facebook" checked> Facebook</label>
          <label style="font-size:11px;color:#cfcfcf;"><input type="checkbox" class="aiPlatform" value="X"> X</label>
          <label style="font-size:11px;color:#cfcfcf;"><input type="checkbox" class="aiPlatform" value="WhatsApp"> WhatsApp</label>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
        <label for="aiTone" style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;">Tone</label>
        <input id="aiTone" type="text" placeholder="underground, confident, zero-fluff" style="background:rgba(255,255,255,0.05);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;color:#ffffff;font-size:12px;padding:10px 12px;font-family:inherit;">
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
        <label for="aiCTA" style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;">Primary CTA</label>
        <input id="aiCTA" type="text" placeholder="Lock your spot ‚Ä¢ Tables & Tickets" style="background:rgba(255,255,255,0.05);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;color:#ffffff;font-size:12px;padding:10px 12px;font-family:inherit;">
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
        <label for="aiHashtags" style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;">Hashtags (optional)</label>
        <input id="aiHashtags" type="text" placeholder="#SoundFactory #NYCNightlife #JonathanPeters #Halloween2025" style="background:rgba(255,255,255,0.05);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;color:#ffffff;font-size:12px;padding:10px 12px;font-family:inherit;">
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:12px;">
        <label for="aiNotes" style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;">Notes to include (optional)</label>
        <input id="aiNotes" type="text" placeholder="Early Bird ends soon. VIP tables limited. 21+" style="background:rgba(255,255,255,0.05);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;color:#ffffff;font-size:12px;padding:10px 12px;font-family:inherit;">
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;">
        <button style="background:linear-gradient(135deg, #6772e5 0%, #5469d4 100%);color:#ffffff;border:none;padding:12px 24px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;cursor:pointer;border-radius:2px;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(103,114,229,0.3);" id="btnBuildLinks" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 16px rgba(103,114,229,0.5)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 12px rgba(103,114,229,0.3)'">üîó Build Links</button>
        <button style="background:linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);color:#ffffff;border:none;padding:12px 24px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;cursor:pointer;border-radius:2px;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(255,107,107,0.3);" id="btnGenerate" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 16px rgba(255,107,107,0.5)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 12px rgba(255,107,107,0.3)'">‚ú® Generate Captions</button>
        <button style="background:linear-gradient(135deg, #4caf50 0%, #45a049 100%);color:#ffffff;border:none;padding:12px 24px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;cursor:pointer;border-radius:2px;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(76,175,80,0.3);" id="btnAssets" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 16px rgba(76,175,80,0.5)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 12px rgba(76,175,80,0.3)'">üì¶ Build Asset Kit</button>
      </div>
      <p style="font-size:10px;color:#666;margin-top:12px;line-height:1.4;">Links + captions are generated client-side. For production, wire these to your endpoints.</p>
    </div>

    <!-- Right: Output -->
    <div style="display:flex;flex-direction:column;gap:12px;">
      <!-- Links -->
      <div style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;padding:12px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
          <h3 style="font-size:12px;font-weight:700;letter-spacing:.2px;">Links</h3>
          <div style="display:flex;gap:8px;">
            <button style="height:26px;padding:0 10px;font-size:10px;text-transform:uppercase;border-radius:2px;background:#ffffff;color:#000000;border:none;cursor:pointer;" id="copyPromo">Copy Promo</button>
            <button style="height:26px;padding:0 10px;font-size:10px;text-transform:uppercase;border-radius:2px;background:#ffffff;color:#000000;border:none;cursor:pointer;" id="copyUtm">Copy UTM</button>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center;margin:6px 0;">
          <div style="font-size:10px;color:#bdbdbd;text-transform:uppercase;">Promo Link</div>
          <div style="font-family:Menlo,Consolas,monospace;font-size:11px;word-break:break-all;" id="outPromo">‚Äî</div>
        </div>
        <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center;margin:6px 0;">
          <div style="font-size:10px;color:#bdbdbd;text-transform:uppercase;">UTM Link</div>
          <div style="font-family:Menlo,Consolas,monospace;font-size:11px;word-break:break-all;" id="outUtm">‚Äî</div>
        </div>
        <div style="display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center;margin:6px 0;">
          <div style="font-size:10px;color:#bdbdbd;text-transform:uppercase;">QR Code</div>
          <div style="font-family:Menlo,Consolas,monospace;font-size:11px;">/api/qr?url=ENCODED</div>
        </div>
      </div>

      <!-- Captions -->
      <div style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;padding:12px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
          <h3 style="font-size:12px;font-weight:700;letter-spacing:.2px;">Caption Variations</h3>
          <button style="height:26px;padding:0 10px;font-size:10px;text-transform:uppercase;border-radius:2px;background:#ffffff;color:#000000;border:none;cursor:pointer;" id="copyCaptions">Copy All</button>
        </div>
        <ol id="outCaptions" style="display:flex;flex-direction:column;gap:8px;padding-left:16px;font-size:12px;line-height:1.35;"></ol>
      </div>

      <!-- Hashtags -->
      <div style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;padding:12px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
          <h3 style="font-size:12px;font-weight:700;letter-spacing:.2px;">Hashtag Packs</h3>
          <div style="display:flex;gap:8px;">
            <button style="height:26px;padding:0 10px;font-size:10px;text-transform:uppercase;border-radius:2px;background:#ffffff;color:#000000;border:none;cursor:pointer;" id="copyTagsCore">Copy Core</button>
            <button style="height:26px;padding:0 10px;font-size:10px;text-transform:uppercase;border-radius:2px;background:#ffffff;color:#000000;border:none;cursor:pointer;" id="copyTagsAlt">Copy Alt</button>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div>
            <div style="font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#6772e5;margin-bottom:8px;">Core</div>
            <div style="font-family:Menlo,Consolas,monospace;font-size:11px;" id="tagsCore">#SoundFactory #JonathanPeters #NYCNightlife #HouseMusic #Halloween2025</div>
          </div>
          <div>
            <div style="font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#6772e5;margin-bottom:8px;">Alt / Rotate</div>
            <div style="font-family:Menlo,Consolas,monospace;font-size:11px;" id="tagsAlt">#Underground #NYCClubs #RaveCulture #Afterhours #Legendary</div>
          </div>
        </div>
      </div>

      <!-- Assets -->
      <div style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;padding:12px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
          <h3 style="font-size:12px;font-weight:700;letter-spacing:.2px;">Asset Kit</h3>
          <a style="height:26px;padding:0 10px;font-size:10px;text-transform:uppercase;border-radius:2px;background:#ffffff;color:#000000;border:none;cursor:pointer;text-decoration:none;display:flex;align-items:center;" id="downloadPack" href="#" download>Download .zip</a>
        </div>
        <ul style="list-style:none;padding-left:0;font-size:12px;line-height:1.5;color:#F0F0F0;">
          <li style="margin-bottom:6px;"><span style="color:#6772e5;margin-right:8px;">‚Ä¢</span> 1080√ó1350 (IG Feed), 1080√ó1920 (Stories/Reels), 1200√ó628 (FB)</li>
          <li style="margin-bottom:6px;"><span style="color:#6772e5;margin-right:8px;">‚Ä¢</span> PNG flyers, square logo mark, table flyer, story frames</li>
          <li style="margin-bottom:6px;"><span style="color:#6772e5;margin-right:8px;">‚Ä¢</span> Caption .txt, hashtag .txt, UTM link .txt</li>
        </ul>
        <p style="font-size:10px;color:#666;margin-top:12px;line-height:1.4;">Hook <span style="font-family:Menlo,Consolas,monospace;">/api/kit</span> to render & zip tailored assets.</p>
      </div>
    </div>
  </div>
</section>

<!-- WILD TEXT GENERATOR -->
<section style="margin-top:24px;background:linear-gradient(135deg, rgba(255,107,107,0.05) 0%, rgba(255,193,7,0.05) 100%);border:0.5px solid rgba(255,107,107,0.3);border-radius:2px;padding:24px;box-shadow:0 8px 32px rgba(255,107,107,0.1);position:relative;overflow:hidden;" id="wild-text-gen">
  <!-- Animated Background -->
  <div style="position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle at 30% 50%, rgba(255,107,107,0.05) 0%, transparent 50%),radial-gradient(circle at 70% 50%, rgba(255,193,7,0.05) 0%, transparent 50%);opacity:0.5;pointer-events:none;animation:pulseGlow 6s ease-in-out infinite;"></div>
  
  <div style="position:relative;z-index:1;">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
      <div style="font-size:24px;animation:bounce 2s ease-in-out infinite;">üî•</div>
      <h2 style="font-size:18px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;background:linear-gradient(135deg, #ff6b6b 0%, #ffc107 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">Wild Text Generator</h2>
    </div>
    <p style="font-size:12px;color:#999;margin-bottom:24px;">üéØ Generate platform-specific content with custom vibes, emojis, and ultra-targeted messaging</p>
  
    <!-- Template Grid -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:24px;">
      <div class="text-template" data-vibe="hype" style="background:linear-gradient(135deg, rgba(255,107,107,0.1) 0%, rgba(255,107,107,0.05) 100%);border:0.5px solid rgba(255,107,107,0.3);border-radius:2px;padding:16px;cursor:pointer;transition:all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 8px 24px rgba(255,107,107,0.3)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'" onclick="selectTemplate('hype')">
        <div style="font-size:20px;margin-bottom:8px;">üöÄ</div>
        <div style="font-size:12px;font-weight:700;margin-bottom:4px;color:#ff6b6b;">HYPE MODE</div>
        <div style="font-size:10px;color:#999;line-height:1.4;">High energy, all caps, fire emojis, urgency</div>
      </div>
      
      <div class="text-template" data-vibe="underground" style="background:linear-gradient(135deg, rgba(103,114,229,0.1) 0%, rgba(103,114,229,0.05) 100%);border:0.5px solid rgba(103,114,229,0.3);border-radius:2px;padding:16px;cursor:pointer;transition:all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 8px 24px rgba(103,114,229,0.3)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'" onclick="selectTemplate('underground')">
        <div style="font-size:20px;margin-bottom:8px;">üåÉ</div>
        <div style="font-size:12px;font-weight:700;margin-bottom:4px;color:#6772e5;">UNDERGROUND</div>
        <div style="font-size:10px;color:#999;line-height:1.4;">Minimal, confident, no fluff, insider vibe</div>
      </div>
      
      <div class="text-template" data-vibe="luxury" style="background:linear-gradient(135deg, rgba(255,193,7,0.1) 0%, rgba(255,193,7,0.05) 100%);border:0.5px solid rgba(255,193,7,0.3);border-radius:2px;padding:16px;cursor:pointer;transition:all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 8px 24px rgba(255,193,7,0.3)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'" onclick="selectTemplate('luxury')">
        <div style="font-size:20px;margin-bottom:8px;">üëë</div>
        <div style="font-size:12px;font-weight:700;margin-bottom:4px;color:#ffc107;">VIP LUXURY</div>
        <div style="font-size:10px;color:#999;line-height:1.4;">Exclusive, sophisticated, premium tables</div>
      </div>
      
      <div class="text-template" data-vibe="story" style="background:linear-gradient(135deg, rgba(156,39,176,0.1) 0%, rgba(156,39,176,0.05) 100%);border:0.5px solid rgba(156,39,176,0.3);border-radius:2px;padding:16px;cursor:pointer;transition:all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 8px 24px rgba(156,39,176,0.3)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'" onclick="selectTemplate('story')">
        <div style="font-size:20px;margin-bottom:8px;">üìñ</div>
        <div style="font-size:12px;font-weight:700;margin-bottom:4px;color:#9c27b0;">STORYTELLING</div>
        <div style="font-size:10px;color:#999;line-height:1.4;">Narrative, legacy, legendary moments</div>
      </div>
      
      <div class="text-template" data-vibe="fomo" style="background:linear-gradient(135deg, rgba(244,67,54,0.1) 0%, rgba(244,67,54,0.05) 100%);border:0.5px solid rgba(244,67,54,0.3);border-radius:2px;padding:16px;cursor:pointer;transition:all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 8px 24px rgba(244,67,54,0.3)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'" onclick="selectTemplate('fomo')">
        <div style="font-size:20px;margin-bottom:8px;">‚è∞</div>
        <div style="font-size:12px;font-weight:700;margin-bottom:4px;color:#f44336;">FOMO TRIGGER</div>
        <div style="font-size:10px;color:#999;line-height:1.4;">Scarcity, limited spots, last chance</div>
      </div>
      
      <div class="text-template" data-vibe="casual" style="background:linear-gradient(135deg, rgba(76,175,80,0.1) 0%, rgba(76,175,80,0.05) 100%);border:0.5px solid rgba(76,175,80,0.3);border-radius:2px;padding:16px;cursor:pointer;transition:all 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 8px 24px rgba(76,175,80,0.3)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'" onclick="selectTemplate('casual')">
        <div style="font-size:20px;margin-bottom:8px;">üòé</div>
        <div style="font-size:12px;font-weight:700;margin-bottom:4px;color:#4caf50;">CASUAL VIBE</div>
        <div style="font-size:10px;color:#999;line-height:1.4;">Friendly, chill, conversational</div>
      </div>
    </div>
    
    <!-- Platform Selector -->
    <div style="margin-bottom:16px;">
      <label style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;display:block;margin-bottom:8px;">Target Platform</label>
      <div style="display:flex;flex-wrap:wrap;gap:8px;">
        <button class="platform-btn" data-platform="instagram" style="padding:8px 16px;background:linear-gradient(135deg, #833ab4 0%, #fd1d1d 50%, #fcb045 100%);color:#fff;border:none;border-radius:2px;font-size:11px;font-weight:700;cursor:pointer;transition:all 0.3s ease;" onclick="selectPlatform('instagram')">üì∏ Instagram</button>
        <button class="platform-btn" data-platform="tiktok" style="padding:8px 16px;background:#000000;color:#69C9D0;border:1px solid #69C9D0;border-radius:2px;font-size:11px;font-weight:700;cursor:pointer;transition:all 0.3s ease;" onclick="selectPlatform('tiktok')">üéµ TikTok</button>
        <button class="platform-btn" data-platform="facebook" style="padding:8px 16px;background:#1877f2;color:#fff;border:none;border-radius:2px;font-size:11px;font-weight:700;cursor:pointer;transition:all 0.3s ease;" onclick="selectPlatform('facebook')">üëç Facebook</button>
        <button class="platform-btn" data-platform="twitter" style="padding:8px 16px;background:#000000;color:#fff;border:1px solid #fff;border-radius:2px;font-size:11px;font-weight:700;cursor:pointer;transition:all 0.3s ease;" onclick="selectPlatform('twitter')">üê¶ X/Twitter</button>
        <button class="platform-btn" data-platform="whatsapp" style="padding:8px 16px;background:#25D366;color:#fff;border:none;border-radius:2px;font-size:11px;font-weight:700;cursor:pointer;transition:all 0.3s ease;" onclick="selectPlatform('whatsapp')">üí¨ WhatsApp</button>
      </div>
    </div>
    
    <!-- Custom Input -->
    <div style="margin-bottom:16px;">
      <label for="wildCustom" style="font-size:11px;font-weight:600;color:#cfcfcf;text-transform:uppercase;letter-spacing:0.5px;display:block;margin-bottom:8px;">Custom Instructions (Optional)</label>
      <input id="wildCustom" type="text" placeholder="e.g., mention DJ lineup, include early bird pricing, add Table 6 availability" style="width:100%;background:rgba(255,255,255,0.05);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;color:#ffffff;font-size:12px;padding:10px 12px;font-family:inherit;">
    </div>
    
    <!-- Generate Button -->
    <button id="btnGenerateWild" style="background:linear-gradient(135deg, #ff6b6b 0%, #ffc107 100%);color:#000;border:none;padding:14px 32px;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;cursor:pointer;border-radius:2px;transition:all 0.3s ease;box-shadow:0 6px 20px rgba(255,107,107,0.4);width:100%;" onmouseover="this.style.transform='scale(1.02)';this.style.boxShadow='0 8px 28px rgba(255,107,107,0.6)'" onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 6px 20px rgba(255,107,107,0.4)'" onclick="generateWildText()">üé® Generate Wild Text</button>
    
    <!-- Output -->
    <div id="wildOutput" style="margin-top:24px;display:none;">
      <div style="background:rgba(255,255,255,0.02);border:0.5px solid rgba(255,255,255,0.15);border-radius:2px;padding:16px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
          <h3 style="font-size:12px;font-weight:700;letter-spacing:.2px;">Generated Content</h3>
          <button id="copyWildText" style="height:28px;padding:0 12px;font-size:10px;text-transform:uppercase;border-radius:2px;background:linear-gradient(135deg, #6772e5 0%, #5469d4 100%);color:#fff;border:none;cursor:pointer;transition:all 0.3s ease;" onclick="copyWild()">üìã Copy</button>
        </div>
        <div id="wildTextContent" style="background:rgba(0,0,0,0.3);border:0.5px solid rgba(255,255,255,0.1);border-radius:2px;padding:16px;font-size:13px;line-height:1.6;color:#f0f0f0;white-space:pre-wrap;font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text',sans-serif;"></div>
        <div style="display:flex;gap:8px;margin-top:12px;font-size:10px;color:#999;">
          <span id="charCount">0 characters</span>
          <span>‚Ä¢</span>
          <span id="platformOptimal">‚úÖ Optimal for selected platform</span>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
@media (max-width:820px){
  #ai-kit > div:first-of-type{
    grid-template-columns:1fr !important;
  }
}

/* AI Kit Animations */
@keyframes pulseGlow {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.6; }
}

@keyframes rotate360 {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

@keyframes slideIn {
  from { 
    opacity: 0;
    transform: translateY(20px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

.text-template.selected {
  border-color: #ff6b6b !important;
  background: linear-gradient(135deg, rgba(255,107,107,0.2) 0%, rgba(255,107,107,0.1) 100%) !important;
  box-shadow: 0 0 20px rgba(255,107,107,0.4) !important;
}

.platform-btn.active {
  box-shadow: 0 0 16px rgba(255,255,255,0.3);
  transform: scale(1.05);
}
</style>

<script>
// Get promo code from URL
const urlParams = new URLSearchParams(window.location.search);
const promoCode = urlParams.get('code') || urlParams.get('promo') || 'JP2025';

// AI Kit Functions
(function(){
  const $ = sel => document.querySelector(sel);
  const promo = () => ($("#aiPromo").value || "").trim();
  const base  = () => ($("#aiBaseUrl").value || "").trim().replace(/\/+$/,'');
  const tone  = () => ($("#aiTone").value || "underground, confident, zero-fluff").trim();
  const eventName = () => ($("#aiEventName").value || "Sound Factory S√©ance ‚Äî Halloween").trim();
  const eventDate = () => ($("#aiEventDate").value || "Nov 1, New York City").trim();
  const cta   = () => ($("#aiCTA").value || "Lock your spot ‚Ä¢ Tables & Tickets").trim();
  const notes = () => ($("#aiNotes").value || "").trim();
  const tagsCore = () => $("#tagsCore").textContent.trim();
  const tagsAlt  = () => $("#tagsAlt").textContent.trim();
  const platforms = () => Array.from(document.querySelectorAll(".aiPlatform:checked")).map(el=>el.value);

  function buildPromoLink(){
    const p = promo() || promoCode;
    if(!p){ alert("Enter your promo code"); return; }
    const url = `${base() || 'https://soundfactorynyc.com/halloween'}?promo=${encodeURIComponent(p)}`;
    $("#outPromo").textContent = url;
    const utm = `${url}&utm_source=${encodeURIComponent(p)}&utm_medium=partner&utm_campaign=${encodeURIComponent(eventName().toLowerCase().replace(/\s+/g,'-'))}`;
    $("#outUtm").textContent = utm;
    $("#downloadPack").href = "#";
    if(!$("#aiPromo").value) $("#aiPromo").value = p;
  }

  function copyText(text){
    navigator.clipboard.writeText(text).then(()=>{alert('Copied!')},()=>{});
  }

  function generateCaptions(){
    const p = promo() || promoCode;
    if(!p){ alert("Enter your promo code"); return; }
    const outs = $("#outCaptions");
    outs.innerHTML = "";
    const vibe = tone();
    const list = [];

    const baseLink = $("#outUtm").textContent || $("#outPromo").textContent || `${base() || 'https://soundfactorynyc.com/halloween'}?promo=${encodeURIComponent(p)}`;

    const templates = [
      ({en,ed,cta,link}) => `üñ§ ${en}\n${ed}\n${cta}\n${link}`,
      ({en,ed,cta,link}) => `${en} ‚Äî ${ed}\n${cta}\n${link}`,
      ({en,ed,cta,link}) => `Underground. Iconic. ${en}.\n${cta}\n${link}`,
      ({en,ed,cta,link}) => `No fluff. Just ${en}.\n${cta} ‚Ä¢ ${link}`,
      ({en,ed,cta,link}) => `${en} | ${ed}\n${cta}\n${link}`
    ];

    const ctx = {
      en: eventName(),
      ed: eventDate(),
      cta: cta(),
      link: baseLink
    };

    for(let i=0;i<5;i++){
      const t = templates[i % templates.length];
      let caption = t(ctx);
      const tags = (i%2===0 ? tagsCore() : tagsAlt());
      if(tags) caption += `\n\n${tags}`;
      if(vibe) caption += `\n\n// ${vibe}`;
      list.push(caption);
    }

    list.forEach(c=>{
      const li = document.createElement("li");
      li.textContent = c;
      outs.appendChild(li);
    });
  }

  $("#btnBuildLinks")?.addEventListener("click", buildPromoLink);
  $("#btnGenerate")?.addEventListener("click", generateCaptions);
  $("#btnAssets")?.addEventListener("click", ()=>{
    alert("Hook this to /api/kit to render a tailored .zip with sizes + text files.");
  });

  $("#copyPromo")?.addEventListener("click", ()=>copyText($("#outPromo").textContent.trim()));
  $("#copyUtm")?.addEventListener("click", ()=>copyText($("#outUtm").textContent.trim()));
  $("#copyCaptions")?.addEventListener("click", ()=>{
    const caps = Array.from(document.querySelectorAll("#outCaptions li")).map(li=>li.textContent).join("\n\n---\n\n");
    if(!caps){ alert("Generate captions first."); return; }
    copyText(caps);
  });
  $("#copyTagsCore")?.addEventListener("click", ()=>copyText(tagsCore()));
  $("#copyTagsAlt")?.addEventListener("click",  ()=>copyText(tagsAlt()));
})();

// WILD TEXT GENERATOR
let selectedVibe = 'hype';
let selectedPlatform = 'instagram';

function selectTemplate(vibe) {
  selectedVibe = vibe;
  // Remove all selected states
  document.querySelectorAll('.text-template').forEach(el => {
    el.classList.remove('selected');
  });
  // Add selected state to clicked template
  document.querySelector(`[data-vibe="${vibe}"]`).classList.add('selected');
}

function selectPlatform(platform) {
  selectedPlatform = platform;
  // Remove all active states
  document.querySelectorAll('.platform-btn').forEach(el => {
    el.classList.remove('active');
  });
  // Add active state to clicked button
  document.querySelector(`[data-platform="${platform}"]`).classList.add('active');
}

function generateWildText() {
  const eventName = document.getElementById('aiEventName').value || 'Sound Factory S√©ance ‚Äî Halloween';
  const eventDate = document.getElementById('aiEventDate').value || 'Nov 1, New York City';
  const promoCode = document.getElementById('aiPromo').value || 'YOURCODE';
  const baseUrl = document.getElementById('aiBaseUrl').value || 'https://soundfactorynyc.com/halloween';
  const customInstructions = document.getElementById('wildCustom').value || '';
  
  const link = `${baseUrl}?promo=${promoCode}`;
  
  // Template variations based on vibe
  const templates = {
    hype: [
      `üî• ${eventName.toUpperCase()} üî•\n\n${eventDate}\n\nTHIS IS NOT A DRILL. LIMITED SPOTS.\n\nUse code ${promoCode} üëá\n${link}\n\n#LEGENDARY #NYC #HOUSEMUSIC`,
      `üö® ALERT üö®\n\n${eventName}\n${eventDate}\n\nTHE MOST TALKED ABOUT NIGHT IN NYC.\n\nLock it in: ${promoCode}\n${link}\n\nüî•üî•üî•`,
      `‚ö°Ô∏è ${eventName.toUpperCase()} ‚ö°Ô∏è\n\nDate: ${eventDate}\n\nIF YOU KNOW, YOU KNOW.\nIf you don't... you're about to.\n\nPromo: ${promoCode}\n${link}`
    ],
    underground: [
      `${eventName}\n${eventDate}\n\nNo fluff. Just the sound.\n\nCode: ${promoCode}\n${link}`,
      `Underground. Iconic. ${eventName}.\n\n${eventDate}\n\nFor those who know.\n\n${promoCode} ‚Ä¢ ${link}`,
      `${eventName}\n${eventDate}\n\nThe real ones are already there.\nAre you?\n\n${promoCode}\n${link}`
    ],
    luxury: [
      `‚ú® ${eventName} ‚ú®\n\n${eventDate}\n\nExclusive VIP tables available.\nLimited capacity. Premium experience.\n\nReserve with: ${promoCode}\n${link}`,
      `üëë VIP Experience üëë\n\n${eventName}\n${eventDate}\n\nBottle service ‚Ä¢ Premium seating ‚Ä¢ Unforgettable night\n\nCode: ${promoCode}\n${link}`,
      `Elevated nightlife.\n\n${eventName}\n${eventDate}\n\nVIP tables selling fast.\n\n${promoCode} ‚Ä¢ ${link}`
    ],
    story: [
      `Since the golden era, Sound Factory has defined NYC nightlife.\n\n${eventName}\n${eventDate}\n\nBe part of the legacy.\n\nCode: ${promoCode}\n${link}`,
      `Jonathan Peters. Legendary sound. Unforgettable nights.\n\n${eventName} returns\n${eventDate}\n\nExperience history in the making.\n\n${promoCode}\n${link}`,
      `The dance floor. The sound. The moment.\n\n${eventName}\n${eventDate}\n\nWhere legends are made.\n\n${promoCode} ‚Ä¢ ${link}`
    ],
    fomo: [
      `‚è∞ LAST CHANCE ‚è∞\n\n${eventName}\n${eventDate}\n\nTables almost sold out.\nTickets disappearing fast.\n\nDon't miss out: ${promoCode}\n${link}`,
      `üö® FINAL CALL üö®\n\n${eventName} is THIS WEEKEND\n\nLess than 20 tickets left.\n\nGrab yours: ${promoCode}\n${link}`,
      `Everyone's talking about it.\nEveryone's going.\n\nAre you?\n\n${eventName}\n${eventDate}\n\n${promoCode} ‚Ä¢ ${link}`
    ],
    casual: [
      `Hey! ${eventName} is coming up üòé\n\n${eventDate}\n\nGonna be epic. You in?\n\nUse my code: ${promoCode}\n${link}`,
      `So... ${eventName} üéµ\n\n${eventDate}\n\nGood vibes, great music, better people.\n\nCome through: ${promoCode}\n${link}`,
      `Just a heads up ‚Äî ${eventName} happening soon!\n\n${eventDate}\n\nWould love to see you there üôå\n\n${promoCode}\n${link}`
    ]
  };
  
  // Platform-specific adjustments
  const platformLimits = {
    instagram: { maxChars: 2200, hashtags: true, emojis: true },
    tiktok: { maxChars: 300, hashtags: true, emojis: true },
    facebook: { maxChars: 63206, hashtags: false, emojis: true },
    twitter: { maxChars: 280, hashtags: true, emojis: true },
    whatsapp: { maxChars: 4096, hashtags: false, emojis: true }
  };
  
  // Get random template from selected vibe
  const vibeTemplates = templates[selectedVibe] || templates.hype;
  let text = vibeTemplates[Math.floor(Math.random() * vibeTemplates.length)];
  
  // Add custom instructions if provided
  if (customInstructions) {
    text += `\n\n${customInstructions}`;
  }
  
  // Platform-specific modifications
  const platformConfig = platformLimits[selectedPlatform];
  if (!platformConfig.hashtags) {
    // Remove hashtags for platforms that don't use them well
    text = text.replace(/#\w+/g, '').trim();
  }
  if (!platformConfig.emojis && selectedPlatform === 'twitter') {
    // Twitter X is more text-focused now
  }
  
  // Truncate if needed
  if (text.length > platformConfig.maxChars) {
    text = text.substring(0, platformConfig.maxChars - 3) + '...';
  }
  
  // Display output with animation
  const output = document.getElementById('wildOutput');
  const content = document.getElementById('wildTextContent');
  const charCount = document.getElementById('charCount');
  const platformOptimal = document.getElementById('platformOptimal');
  
  content.textContent = text;
  charCount.textContent = `${text.length} characters`;
  
  const isOptimal = text.length <= platformConfig.maxChars * 0.9;
  platformOptimal.textContent = isOptimal 
    ? `‚úÖ Optimal for ${selectedPlatform}` 
    : `‚ö†Ô∏è Near ${selectedPlatform} limit`;
  platformOptimal.style.color = isOptimal ? '#4caf50' : '#ff9800';
  
  output.style.display = 'block';
  output.style.animation = 'slideIn 0.4s ease-out';
}

function copyWild() {
  const text = document.getElementById('wildTextContent').textContent;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById('copyWildText');
    const originalText = btn.innerHTML;
    btn.innerHTML = '‚úÖ Copied!';
    btn.style.background = 'linear-gradient(135deg, #4caf50 0%, #45a049 100%)';
    setTimeout(() => {
      btn.innerHTML = originalText;
      btn.style.background = 'linear-gradient(135deg, #6772e5 0%, #5469d4 100%)';
    }, 2000);
  });
}

// Initialize with defaults
document.addEventListener('DOMContentLoaded', () => {
  selectTemplate('hype');
  selectPlatform('instagram');
});

// Sample data for demonstration
const samplePromoters = [
  {
    id: '1',
    name: 'Jonathan Peters',
    email: 'jp@soundfactorynyc.com',
    phone: '+19293629534',
    promo_code: 'JP2025',
    status: 'approved',
    commission_earned: 0,
    tickets_sold: 0,
    tables_sold: 0,
    created_at: '2025-10-15'
  }
];

let allPromoters = [...samplePromoters];
let currentFilter = 'all';

// Load initial data
document.addEventListener('DOMContentLoaded', () => {
  // Check if coming from Stripe onboarding
  const urlParams = new URLSearchParams(window.location.search);
  const promoFromUrl = urlParams.get('promo');
  const registered = urlParams.get('registered');
  
  if (promoFromUrl) {
    // Update promo badge
    document.getElementById('promoBadge').textContent = promoFromUrl;
    
    // Update AI Kit promo code field
    const aiPromoField = document.getElementById('aiPromo');
    if (aiPromoField) {
      aiPromoField.value = promoFromUrl;
    }
    
    // Show welcome message if newly registered
    if (registered === 'true') {
      setTimeout(() => {
        alert(`üéâ Welcome to Sound Factory!\n\nYour promo code: ${promoFromUrl}\n\nYou're all set! Start sharing your promo link to earn commissions.`);
      }, 500);
    }
  }
  
  loadPromoters();
  loadPromoCodes();
  updateStats();
});

function loadPromoters() {
  displayPromoters(allPromoters);
}

function displayPromoters(promoters) {
  const tbody = document.getElementById('promotersTable');
  
  if (promoters.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="6" style="text-align:center;padding:40px;color:#666;">
          No promoters found
        </td>
      </tr>
    `;
    return;
  }
  
  tbody.innerHTML = promoters.map(p => `
    <tr>
      <td>
        <div>${p.name}</div>
        <div style="font-size:11px;color:#666;">${p.email}</div>
      </td>
      <td>
        <span class="promo-code">${p.promo_code}</span>
      </td>
      <td>
        <span class="status-badge status-${p.status}">${p.status}</span>
      </td>
      <td>$${p.commission_earned || 0}</td>
      <td>
        ${p.tickets_sold || 0} tickets<br>
        ${p.tables_sold || 0} tables
      </td>
      <td>
        <button class="btn" onclick="viewPromoter('${p.id}')">View</button>
      </td>
    </tr>
  `).join('');
}

function loadPromoCodes() {
  const container = document.getElementById('promoCodeUsage');
  
  const promoCodes = allPromoters.map(p => ({
    code: p.promo_code,
    name: p.name,
    status: p.status,
    sales: (p.tickets_sold || 0) + (p.tables_sold || 0)
  }));
  
  container.innerHTML = promoCodes.map(code => `
    <div class="activity-item">
      <div class="activity-icon">üéüÔ∏è</div>
      <div class="activity-content">
        <div class="activity-title">
          <span class="promo-code">${code.code}</span>
          <span style="color:#666;margin-left:8px;">${code.name}</span>
        </div>
        <div class="activity-time">
          ${code.sales} sales ‚Ä¢ Status: ${code.status}
        </div>
      </div>
    </div>
  `).join('');
}

function updateStats() {
  const approved = allPromoters.filter(p => p.status === 'approved').length;
  const totalCommission = allPromoters.reduce((sum, p) => sum + (p.commission_earned || 0), 0);
  const totalTickets = allPromoters.reduce((sum, p) => sum + (p.tickets_sold || 0), 0);
  const totalTables = allPromoters.reduce((sum, p) => sum + (p.tables_sold || 0), 0);
  
  document.getElementById('totalPromoters').textContent = allPromoters.length;
  document.getElementById('activePromoCodes').textContent = approved;
  document.getElementById('totalCommissions').textContent = `$${totalCommission}`;
  
  // Calculate estimated sales
  const estimatedSales = (totalTickets * 50) + (totalTables * 800);
  document.getElementById('totalSales').textContent = `$${estimatedSales}`;
}

function filterPromoters(status, btn) {
  currentFilter = status;
  
  // Update active tab
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  if (btn) btn.classList.add('active');
  
  // Filter promoters
  let filtered = allPromoters;
  if (status !== 'all') {
    filtered = allPromoters.filter(p => p.status === status);
  }
  
  // Apply search filter if active
  const searchTerm = document.getElementById('searchBox').value.toLowerCase();
  if (searchTerm) {
    filtered = filtered.filter(p => 
      p.name.toLowerCase().includes(searchTerm) ||
      p.email.toLowerCase().includes(searchTerm) ||
      p.phone.includes(searchTerm) ||
      p.promo_code.toLowerCase().includes(searchTerm)
    );
  }
  
  displayPromoters(filtered);
}

function searchPromoters() {
  const searchTerm = document.getElementById('searchBox').value.toLowerCase();
  
  let filtered = allPromoters;
  if (currentFilter !== 'all') {
    filtered = filtered.filter(p => p.status === currentFilter);
  }
  
  if (searchTerm) {
    filtered = filtered.filter(p => 
      p.name.toLowerCase().includes(searchTerm) ||
      p.email.toLowerCase().includes(searchTerm) ||
      p.phone.includes(searchTerm) ||
      p.promo_code.toLowerCase().includes(searchTerm)
    );
  }
  
  displayPromoters(filtered);
}

function viewPromoter(id) {
  const promoter = allPromoters.find(p => p.id === id);
  if (promoter) {
    alert(`
Promoter Details:
Name: ${promoter.name}
Email: ${promoter.email}
Phone: ${promoter.phone}
Promo Code: ${promoter.promo_code}
Status: ${promoter.status}
Commission Earned: $${promoter.commission_earned || 0}
Tickets Sold: ${promoter.tickets_sold || 0}
Tables Sold: ${promoter.tables_sold || 0}
Joined: ${promoter.created_at}
    `);
  }
}

function exportData() {
  // Create CSV content
  const headers = ['Name', 'Email', 'Phone', 'Promo Code', 'Status', 'Commission', 'Tickets', 'Tables'];
  const rows = allPromoters.map(p => [
    p.name,
    p.email,
    p.phone,
    p.promo_code,
    p.status,
    p.commission_earned || 0,
    p.tickets_sold || 0,
    p.tables_sold || 0
  ]);
  
  let csvContent = headers.join(',') + '\n';
  rows.forEach(row => {
    csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
  });
  
  // Download CSV
  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `promoters_export_${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  window.URL.revokeObjectURL(url);
}

function refreshData() {
  // Show loading state
  const btn = event.target;
  btn.textContent = 'Loading...';
  btn.disabled = true;
  
  // Simulate refresh
  setTimeout(() => {
    loadPromoters();
    loadPromoCodes();
    updateStats();
    btn.textContent = 'Refresh';
    btn.disabled = false;
  }, 1000);
}

// Auto-refresh every 30 seconds
setInterval(() => {
  loadPromoters();
  updateStats();
}, 30000);

// Initialize Leaflet Map
(function initMap(){
  // Sample sales data with real coordinates
  const salesData = [
    { location: "Brooklyn, NY", lat: 40.6782, lng: -73.9442, sales: 12, customers: ["John D.", "Sarah K.", "Mike T."] },
    { location: "Manhattan, NY", lat: 40.7580, lng: -73.9855, sales: 25, customers: ["Lisa M.", "David R.", "Emma S."] },
    { location: "Queens, NY", lat: 40.7282, lng: -73.7949, sales: 8, customers: ["Alex P.", "Nina W."] },
    { location: "Jersey City, NJ", lat: 40.7178, lng: -74.0431, sales: 5, customers: ["Tom H."] },
    { location: "Bronx, NY", lat: 40.8448, lng: -73.8648, sales: 6, customers: ["Maria G.", "Chris B."] },
    { location: "Long Island City, NY", lat: 40.7447, lng: -73.9485, sales: 15, customers: ["James L.", "Sofia R."] },
    { location: "Williamsburg, Brooklyn", lat: 40.7081, lng: -73.9571, sales: 18, customers: ["Ryan K.", "Olivia M."] }
  ];

  // Initialize map centered on NYC
  const map = L.map('mapContainer', {
    center: [40.7580, -73.9855],
    zoom: 11,
    zoomControl: true,
    attributionControl: true
  });

  // Add dark tile layer (CartoDB Dark Matter)
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
    subdomains: 'abcd',
    maxZoom: 20
  }).addTo(map);

  // Function to determine marker color based on sales volume
  function getMarkerColor(sales) {
    if (sales >= 10) return '#f44336'; // Red for 10+ sales
    if (sales >= 4) return '#ff9800';  // Orange for 4-10 sales
    return '#4caf50';                  // Green for 1-3 sales
  }

  // Function to determine marker size based on sales volume
  function getMarkerSize(sales) {
    if (sales >= 10) return 16;
    if (sales >= 4) return 12;
    return 8;
  }

  // Add markers for each sale location
  salesData.forEach(sale => {
    const color = getMarkerColor(sale.sales);
    const size = getMarkerSize(sale.sales);
    
    // Create custom icon
    const customIcon = L.divIcon({
      className: 'custom-marker',
      html: `<div style="
        width:${size}px;
        height:${size}px;
        background:${color};
        border:2px solid #000;
        border-radius:50%;
        box-shadow:0 0 10px ${color};
        animation:marker-pulse 2s infinite;
      "></div>`,
      iconSize: [size, size],
      iconAnchor: [size/2, size/2]
    });

    // Create marker
    const marker = L.marker([sale.lat, sale.lng], { icon: customIcon }).addTo(map);
    
    // Create popup content
    const popupContent = `
      <div style="padding:8px;min-width:150px;">
        <div style="font-size:12px;font-weight:700;margin-bottom:6px;color:#fff;">${sale.location}</div>
        <div style="font-size:11px;color:#4caf50;margin-bottom:6px;">
          <strong>${sale.sales}</strong> sale${sale.sales > 1 ? 's' : ''}
        </div>
        <div style="font-size:10px;color:#999;margin-bottom:4px;">Recent customers:</div>
        <div style="font-size:10px;color:#ccc;">
          ${sale.customers.map(c => `‚Ä¢ ${c}`).join('<br>')}
        </div>
        <div style="font-size:9px;color:#666;margin-top:6px;padding-top:6px;border-top:0.5px solid rgba(255,255,255,0.1);">
          Click marker for details
        </div>
      </div>
    `;
    
    marker.bindPopup(popupContent);
    
    // Add click handler for detailed view
    marker.on('click', function() {
      console.log(`Viewing details for ${sale.location}: ${sale.sales} sales`);
    });
  });

  // Fit bounds to show all markers
  const group = new L.featureGroup(salesData.map(sale => L.marker([sale.lat, sale.lng])));
  map.fitBounds(group.getBounds().pad(0.1));
})();
</script>

</body>
</html>