<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Promoter Dashboard - Sound Factory</title>
  <style>
    :root{--bg:#000;--ink:#fff;--muted:#999;--edge:#222;--accent:#8b5cf6;--success:#10b981}
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{margin:0;padding:0}
    body{
      background:#000;
      color:#fff;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      padding:20px;
      line-height:1.6;
      min-height:100vh;
    }
    .container{
      width:100%;
      max-width:1200px;
      margin:0 auto;
    }
    
    /* Header */
    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:40px;
      padding-bottom:20px;
      border-bottom:1px solid var(--edge);
    }
    .logo{
      width:60px;
      height:60px;
      object-fit:contain;
    }
    .header-right{
      text-align:right;
    }
    .promoter-name{
      font-size:20px;
      font-weight:600;
      margin-bottom:4px;
    }
    .promo-code-badge{
      display:inline-block;
      background:var(--accent);
      color:#fff;
      padding:4px 12px;
      border-radius:20px;
      font-size:12px;
      font-weight:600;
      letter-spacing:0.5px;
    }
    .logout-btn{
      color:var(--muted);
      text-decoration:none;
      font-size:14px;
      margin-top:8px;
      display:inline-block;
    }
    .logout-btn:hover{
      color:var(--ink);
    }

    /* Stats Grid */
    .stats-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:20px;
      margin-bottom:40px;
    }
    .stat-card{
      background:var(--edge);
      border:1px solid #333;
      border-radius:12px;
      padding:24px;
      text-align:center;
    }
    .stat-value{
      font-size:36px;
      font-weight:700;
      color:var(--accent);
      margin-bottom:8px;
    }
    .stat-label{
      color:var(--muted);
      font-size:14px;
      text-transform:uppercase;
      letter-spacing:1px;
    }

    /* Section */
    .section{
      background:var(--edge);
      border:1px solid #333;
      border-radius:12px;
      padding:32px;
      margin-bottom:24px;
    }
    .section-title{
      font-size:24px;
      font-weight:700;
      margin-bottom:20px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .section-subtitle{
      color:var(--muted);
      font-size:14px;
      margin-bottom:20px;
    }

    /* Link Box */
    .link-box{
      background:#111;
      border:1px solid #333;
      border-radius:8px;
      padding:16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:20px;
    }
    .link-text{
      flex:1;
      color:var(--accent);
      font-family:monospace;
      font-size:14px;
      word-break:break-all;
    }
    .copy-btn{
      background:var(--accent);
      color:#fff;
      border:none;
      padding:8px 16px;
      border-radius:6px;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
      white-space:nowrap;
      transition:all 0.2s;
    }
    .copy-btn:hover{
      background:#7c3aed;
    }
    .copy-btn.copied{
      background:var(--success);
    }

    /* Marketing Materials */
    .materials-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:20px;
    }
    .material-card{
      background:#111;
      border:1px solid #333;
      border-radius:8px;
      padding:20px;
    }
    .material-title{
      font-size:18px;
      font-weight:600;
      margin-bottom:12px;
    }
    .material-desc{
      color:var(--muted);
      font-size:14px;
      margin-bottom:16px;
    }
    .material-content{
      background:#000;
      border:1px solid #333;
      border-radius:6px;
      padding:16px;
      font-size:14px;
      line-height:1.6;
      margin-bottom:12px;
      max-height:200px;
      overflow-y:auto;
      white-space:pre-wrap;
    }
    .btn-group{
      display:flex;
      gap:8px;
    }
    .btn{
      flex:1;
      padding:10px 16px;
      border-radius:6px;
      border:none;
      cursor:pointer;
      font-size:14px;
      font-weight:600;
      transition:all 0.2s;
    }
    .btn-primary{
      background:var(--accent);
      color:#fff;
    }
    .btn-primary:hover{
      background:#7c3aed;
    }
    .btn-secondary{
      background:transparent;
      color:var(--muted);
      border:1px solid #333;
    }
    .btn-secondary:hover{
      color:var(--ink);
      border-color:#555;
    }

    /* Flyer Preview */
    .flyer-preview{
      text-align:center;
      margin-bottom:20px;
    }
    .flyer-image{
      max-width:100%;
      height:auto;
      border-radius:8px;
      border:1px solid #333;
      margin-bottom:16px;
    }
    .download-btn{
      display:inline-block;
      background:var(--accent);
      color:#fff;
      padding:12px 24px;
      border-radius:6px;
      text-decoration:none;
      font-weight:600;
      transition:all 0.2s;
    }
    .download-btn:hover{
      background:#7c3aed;
    }

    /* Success Message */
    .success-msg{
      background:var(--success);
      color:#fff;
      padding:12px 16px;
      border-radius:6px;
      font-size:14px;
      font-weight:600;
      display:none;
      margin-bottom:16px;
      animation:slideDown 0.3s ease;
    }
    .success-msg.show{
      display:block;
    }
    @keyframes slideDown{
      from{opacity:0;transform:translateY(-10px)}
      to{opacity:1;transform:translateY(0)}
    }

    /* Loading */
    .loading{
      text-align:center;
      padding:60px 20px;
    }
    .spinner{
      border:3px solid #333;
      border-top:3px solid var(--accent);
      border-radius:50%;
      width:40px;
      height:40px;
      animation:spin 1s linear infinite;
      margin:0 auto 16px;
    }
    @keyframes spin{
      0%{transform:rotate(0deg)}
      100%{transform:rotate(360deg)}
    }

    /* Tabs */
    .tabs{
      display:flex;
      gap:8px;
      margin-bottom:24px;
      border-bottom:1px solid #333;
      padding-bottom:0;
      overflow-x:auto;
    }
    .tab{
      padding:12px 20px;
      background:transparent;
      border:none;
      color:var(--muted);
      cursor:pointer;
      font-size:16px;
      font-weight:600;
      border-bottom:2px solid transparent;
      transition:all 0.2s;
      white-space:nowrap;
    }
    .tab.active{
      color:var(--accent);
      border-bottom-color:var(--accent);
    }
    .tab:hover{
      color:var(--ink);
    }
    .tab-content{
      display:none;
    }
    .tab-content.active{
      display:block;
    }

    .tips-list{
      list-style:none;
    }
    .tips-list li{
      background:#111;
      border:1px solid #333;
      border-radius:8px;
      padding:16px;
      margin-bottom:12px;
    }
    .tips-list li:before{
      content:"üí°";
      margin-right:8px;
    }

    @media (max-width:768px){
      .header{flex-direction:column;gap:16px;text-align:center}
      .header-right{text-align:center}
      .stats-grid{grid-template-columns:1fr}
      .materials-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <img src="sf-logo.png" alt="Sound Factory" class="logo">
      <div class="header-right">
        <div class="promoter-name" id="promoterName">Loading...</div>
        <span class="promo-code-badge" id="promoCodeBadge">...</span>
        <br>
        <a href="#" class="logout-btn" onclick="logout()">Logout</a>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="loading">
      <div class="spinner"></div>
      <div style="color:var(--muted)">Loading your dashboard...</div>
    </div>

    <!-- Dashboard Content -->
    <div id="dashboardContent" style="display:none">
      
      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="ticketsSold">0</div>
          <div class="stat-label">Tickets Sold</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="commissionEarned">$0</div>
          <div class="stat-label">Commission Earned</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="conversionRate">2-5%</div>
          <div class="stat-label">Expected Conversion</div>
        </div>
      </div>

      <!-- Your Referral Link -->
      <div class="section">
        <div class="section-title">üîó Your Unique Referral Link</div>
        <div class="section-subtitle">Share this link to earn $10 per ticket sold! Track every sale in real-time.</div>
        <div class="link-box">
          <div class="link-text" id="referralLink">Loading...</div>
          <button class="copy-btn" onclick="copyLink()">Copy Link</button>
        </div>
        <div class="success-msg" id="linkCopied">‚úì Link copied to clipboard!</div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('materials')">üì± Marketing Kit</button>
        <button class="tab" onclick="switchTab('flyers')">üé® Flyers</button>
        <button class="tab" onclick="switchTab('tips')">üí° Pro Tips</button>
      </div>

      <!-- Tab: Marketing Materials -->
      <div id="tab-materials" class="tab-content active">
        <div class="materials-grid">
          
          <!-- Email Template -->
          <div class="material-card">
            <div class="material-title">üìß Email Template</div>
            <div class="material-desc">Copy & send to your email list</div>
            <div class="material-content" id="emailTemplate">Loading...</div>
            <div class="btn-group">
              <button class="btn btn-primary" onclick="copyMaterial('email')">Copy Email</button>
              <button class="btn btn-secondary" onclick="openEmailClient()">Send Now</button>
            </div>
            <div class="success-msg" id="emailCopied">‚úì Copied!</div>
          </div>

          <!-- Instagram Caption -->
          <div class="material-card">
            <div class="material-title">üì∏ Instagram Post</div>
            <div class="material-desc">Perfect for posts and stories</div>
            <div class="material-content" id="igCaption">Loading...</div>
            <div class="btn-group">
              <button class="btn btn-primary" onclick="copyMaterial('instagram')">Copy Caption</button>
            </div>
            <div class="success-msg" id="igCopied">‚úì Copied!</div>
          </div>

          <!-- Text Message -->
          <div class="material-card">
            <div class="material-title">üí¨ Text Message</div>
            <div class="material-desc">Quick SMS to send friends</div>
            <div class="material-content" id="smsText">Loading...</div>
            <div class="btn-group">
              <button class="btn btn-primary" onclick="copyMaterial('sms')">Copy Text</button>
              <button class="btn btn-secondary" onclick="openSMS()">Send SMS</button>
            </div>
            <div class="success-msg" id="smsCopied">‚úì Copied!</div>
          </div>

          <!-- Twitter/X Post -->
          <div class="material-card">
            <div class="material-title">ùïè Twitter/X</div>
            <div class="material-desc">Optimized for social sharing</div>
            <div class="material-content" id="twitterPost">Loading...</div>
            <div class="btn-group">
              <button class="btn btn-primary" onclick="copyMaterial('twitter')">Copy Post</button>
              <button class="btn btn-secondary" onclick="shareTwitter()">Post Now</button>
            </div>
            <div class="success-msg" id="twitterCopied">‚úì Copied!</div>
          </div>

          <!-- WhatsApp Message -->
          <div class="material-card">
            <div class="material-title">üíö WhatsApp</div>
            <div class="material-desc">Share in groups or DMs</div>
            <div class="material-content" id="whatsappMsg">Loading...</div>
            <div class="btn-group">
              <button class="btn btn-primary" onclick="copyMaterial('whatsapp')">Copy Message</button>
              <button class="btn btn-secondary" onclick="shareWhatsApp()">Share Now</button>
            </div>
            <div class="success-msg" id="whatsappCopied">‚úì Copied!</div>
          </div>

          <!-- Facebook Post -->
          <div class="material-card">
            <div class="material-title">üëç Facebook</div>
            <div class="material-desc">Great for events and groups</div>
            <div class="material-content" id="fbPost">Loading...</div>
            <div class="btn-group">
              <button class="btn btn-primary" onclick="copyMaterial('facebook')">Copy Post</button>
              <button class="btn btn-secondary" onclick="shareFacebook()">Post Now</button>
            </div>
            <div class="success-msg" id="fbCopied">‚úì Copied!</div>
          </div>

        </div>
      </div>

      <!-- Tab: Downloadable Flyers -->
      <div id="tab-flyers" class="tab-content">
        <div class="section">
          <div class="section-title">üé® Your Custom Flyers</div>
          <div class="section-subtitle">Download and share these flyers with your unique link included</div>
          
          <div class="flyer-preview">
            <img src="sf-flyer-optimized.png" alt="Sound Factory Flyer" class="flyer-image" id="flyerImage">
            <div style="margin-bottom:20px">
              <a href="sf-flyer-optimized.png" download="sound-factory-halloween.png" class="download-btn">‚¨áÔ∏è Download Flyer (PNG)</a>
            </div>
            <p style="color:var(--muted);font-size:14px;max-width:600px;margin:0 auto">
              Right-click the image to save, or click the button to download. Share on Instagram stories, Facebook events, or print and post around your area!
            </p>
          </div>
        </div>
      </div>

      <!-- Tab: Pro Tips -->
      <div id="tab-tips" class="tab-content">
        <div class="section">
          <div class="section-title">üí° Pro Promotion Tips</div>
          <ul class="tips-list">
            <li><strong>Post Daily:</strong> Share your link at least once a day on different platforms</li>
            <li><strong>Use Stories:</strong> Instagram and Facebook stories get high engagement - post your flyer there!</li>
            <li><strong>Create Urgency:</strong> Remind people tickets sell out fast (they do!)</li>
            <li><strong>DM Your Friends:</strong> Personal messages convert better than public posts</li>
            <li><strong>Join Facebook Groups:</strong> Find NYC nightlife/events groups and share there</li>
            <li><strong>WhatsApp Groups:</strong> Share in all your group chats - friends, work, school</li>
            <li><strong>Email Your List:</strong> If you have an email list, blast them with the template above</li>
            <li><strong>Offer to Buy First Round:</strong> Tell friends you'll buy their first drink if they come through your link</li>
            <li><strong>Post Multiple Times:</strong> Not everyone sees every post - share 2-3x per day on different platforms</li>
            <li><strong>Use Hashtags:</strong> #SoundFactoryNYC #NYCNightlife #HalloweenNYC #NYCParty</li>
          </ul>
        </div>
      </div>

    </div>
  </div>

  <script>
    let promoterData = {};
    let referralLink = '';
    
    // Load promoter data
    async function loadDashboard() {
      const urlParams = new URLSearchParams(window.location.search);
      const promoCode = urlParams.get('code');
      
      if (!promoCode) {
        window.location.href = 'promoter-login.html';
        return;
      }
      
      try {
        const response = await fetch(`/api/promoter/${promoCode}`);
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'Failed to load dashboard');
        }
        
        promoterData = data;
        referralLink = data.referralLink;
        
        // Update UI
        document.getElementById('promoterName').textContent = data.name;
        document.getElementById('promoCodeBadge').textContent = promoCode;
        document.getElementById('ticketsSold').textContent = data.ticketsSold || 0;
        document.getElementById('commissionEarned').textContent = '$' + (data.commissionEarned || '0.00');
        document.getElementById('referralLink').textContent = referralLink;
        
        // Load marketing materials
        loadMarketingMaterials();
        
        // Show dashboard
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('dashboardContent').style.display = 'block';
        
      } catch (error) {
        alert('Error loading dashboard: ' + error.message);
        window.location.href = 'promoter-login.html';
      }
    }
    
    // Load marketing materials
    function loadMarketingMaterials() {
      const name = promoterData.name || 'a Sound Factory promoter';
      
      // Email template
      document.getElementById('emailTemplate').textContent = `Subject: üéÉ You're Invited: Sound Factory Halloween Party!

Hey!

I'm promoting Sound Factory's epic Halloween party this year and wanted to make sure you didn't miss out!

üéâ Sound Factory Halloween 2025
üìç NYC's Premier Venue
üé´ Get tickets here: ${referralLink}

This is THE party of the year - costume contest, VIP tables, and legendary DJs all night. Tickets are selling fast!

Use my link above to secure your spot. See you on the dance floor! üëª

- ${name}`;

      // Instagram caption
      document.getElementById('igCaption').textContent = `üéÉ SOUND FACTORY HALLOWEEN 2025 üéÉ

NYC's BIGGEST Halloween party is back! 

üî• Legendary DJs
üëª Costume Contest
üéâ VIP Tables Available
üíú Purple Halloween Vibes

Grab your tickets before they sell out üëá
${referralLink}

See you on the dance floor! üï∫üíÉ

#SoundFactoryNYC #HalloweenNYC #NYCNightlife #Halloween2025 #NYCParty`;

      // SMS text
      document.getElementById('smsText').textContent = `Hey! üéÉ I'm promoting Sound Factory's Halloween party - THE party of the year in NYC! Want to come? I can get you tickets: ${referralLink}

It's going to be insane! Let me know üëª`;

      // Twitter post
      document.getElementById('twitterPost').textContent = `üéÉ Sound Factory Halloween 2025 is going to be LEGENDARY

üî• Best DJs in NYC
üëª Epic costume contest
üíú All-night vibes

Don't miss out! 
${referralLink}

#SoundFactoryNYC #HalloweenNYC`;

      // WhatsApp
      document.getElementById('whatsappMsg').textContent = `üéÉ *Sound Factory Halloween 2025* üéÉ

Hey everyone! I'm promoting this year's Sound Factory Halloween party and it's going to be INSANE!

‚ú® NYC's premier venue
üéµ Legendary DJ lineup
üëª Costume contest with prizes
üçæ VIP tables available

Tickets here: ${referralLink}

Let me know if you're coming! This will sell out üî•`;

      // Facebook
      document.getElementById('fbPost').textContent = `üéÉüëª SOUND FACTORY HALLOWEEN 2025 üëªüéÉ

NYC's most legendary Halloween party is back and bigger than ever!

What to expect:
üî• World-class DJ lineup
üíú Purple Halloween theme
üëª Epic costume contest
üçæ VIP bottle service
üéâ All-night dancing

This party sells out EVERY year - don't wait!

üé´ Get tickets: ${referralLink}

Tag your crew! Who's coming with you? üíÉüï∫

#SoundFactoryNYC #HalloweenNYC #NYCNightlife #Halloween2025 #NYCEvents`;
    }
    
    // Copy link function
    function copyLink() {
      navigator.clipboard.writeText(referralLink).then(() => {
        const btn = event.target;
        const msg = document.getElementById('linkCopied');
        btn.textContent = '‚úì Copied!';
        btn.classList.add('copied');
        msg.classList.add('show');
        setTimeout(() => {
          btn.textContent = 'Copy Link';
          btn.classList.remove('copied');
          msg.classList.remove('show');
        }, 2000);
      });
    }
    
    // Copy material function
    function copyMaterial(type) {
      const elements = {
        email: 'emailTemplate',
        instagram: 'igCaption',
        sms: 'smsText',
        twitter: 'twitterPost',
        whatsapp: 'whatsappMsg',
        facebook: 'fbPost'
      };
      
      const messages = {
        email: 'emailCopied',
        instagram: 'igCopied',
        sms: 'smsCopied',
        twitter: 'twitterCopied',
        whatsapp: 'whatsappCopied',
        facebook: 'fbCopied'
      };
      
      const text = document.getElementById(elements[type]).textContent;
      navigator.clipboard.writeText(text).then(() => {
        const msg = document.getElementById(messages[type]);
        msg.classList.add('show');
        setTimeout(() => {
          msg.classList.remove('show');
        }, 2000);
      });
    }
    
    // Open email client
    function openEmailClient() {
      const subject = encodeURIComponent('üéÉ You\'re Invited: Sound Factory Halloween Party!');
      const body = encodeURIComponent(document.getElementById('emailTemplate').textContent);
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    }
    
    // Open SMS
    function openSMS() {
      const text = encodeURIComponent(document.getElementById('smsText').textContent);
      window.location.href = `sms:?&body=${text}`;
    }
    
    // Share Twitter
    function shareTwitter() {
      const text = encodeURIComponent(document.getElementById('twitterPost').textContent);
      window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
    }
    
    // Share WhatsApp
    function shareWhatsApp() {
      const text = encodeURIComponent(document.getElementById('whatsappMsg').textContent);
      window.open(`https://wa.me/?text=${text}`, '_blank');
    }
    
    // Share Facebook
    function shareFacebook() {
      const url = encodeURIComponent(referralLink);
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
    }
    
    // Switch tab
    function switchTab(tab) {
      // Remove active from all tabs and contents
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      // Add active to clicked tab and content
      event.target.classList.add('active');
      document.getElementById(`tab-${tab}`).classList.add('active');
    }
    
    // Logout
    function logout() {
      localStorage.removeItem('sf_session_token');
      localStorage.removeItem('sf_promo_code');
      window.location.href = 'promoter-login.html';
    }
    
    // Load on page load
    loadDashboard();
  </script>
</body>
</html>