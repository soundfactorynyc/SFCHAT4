<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sound Factory - LEGENDARY</title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="SF Legendary">
    <meta name="theme-color" content="#000000">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none;
            -webkit-touch-callout: none;
        }
        
        html, body { 
            background: #000; 
            color: #fff; 
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', system-ui, sans-serif; 
            overflow: hidden; 
            height: 100vh; 
            width: 100vw; 
            position: fixed; 
            -webkit-font-smoothing: antialiased;
            touch-action: none;
        }
        
        /* Blueprint Grid Background - ONLY ON MAIN AREA */
        .blueprint-bg { 
            position: fixed; 
            inset: 0; 
            background: 
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px), 
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px); 
            background-size: 20px 20px; 
            z-index: 1; 
            pointer-events: none; 
        }
        
        /* Header - PURE BLACK */
        .header { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 50px; 
            background: #000; 
            border-bottom: 1px solid rgba(255,255,255,0.1); 
            z-index: 900; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0 15px; 
        }
        
        .logo { 
            font-size: 14px; 
            font-weight: 700; 
            letter-spacing: 0.5px; 
        }
        
        .header-stats { 
            display: flex; 
            gap: 15px; 
            font-size: 11px; 
            color: rgba(255,255,255,0.7); 
        }
        
        .header-stats span {
            color: #fff;
            font-weight: 600;
        }
        
        /* Blueprint Area */
        .blueprint-area { 
            position: fixed; 
            top: 50px; 
            bottom: 170px; 
            left: 0; 
            right: 0; 
            z-index: 10; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 20px; 
        }
        
        svg { 
            width: 100%; 
            height: 100%; 
            max-width: 600px; 
        }
        
        .character { 
            position: absolute; 
            width: 30px; 
            height: 30px; 
            background: #000; 
            border: 2px solid #fff; 
            border-radius: 50%; 
            font-size: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 700; 
            z-index: 100; 
            left: 50%; 
            top: 50%; 
            transform: translate(-50%, -50%); 
            cursor: move;
            transition: box-shadow 0.3s;
        }
        
        .character.dragging {
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }
        
        /* 3 Floating + Buttons - PURE BLACK/WHITE */
        .plus-btn { 
            position: fixed; 
            left: 15px; 
            width: 44px; 
            height: 44px; 
            background: #000; 
            border: 2px solid rgba(255,255,255,0.3); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 28px; 
            color: #fff; 
            cursor: pointer; 
            z-index: 10000; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .plus-btn:active { 
            transform: scale(0.9); 
        }
        
        .plus-btn.active { 
            transform: rotate(45deg); 
            border-color: #fff; 
            background: rgba(255,255,255,0.1);
        }
        
        #topBtn { top: 80px; }
        #middleBtn { top: 50%; transform: translateY(-50%); }
        #middleBtn.active { transform: translateY(-50%) rotate(45deg); }
        #bottomBtn { bottom: 190px; }
        
        /* Grid Overlays - PURE BLACK */
        .grid-overlay { 
            position: fixed; 
            inset: 0; 
            background: #000; 
            z-index: 9500; 
            display: none; 
            flex-direction: column; 
            padding: 70px 20px 180px 80px; 
            overflow-y: auto;
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .grid-overlay.active { 
            display: flex;
            animation: slideIn 0.3s forwards;
        }
        
        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .grid-header { 
            margin-bottom: 20px; 
            padding-bottom: 15px; 
            border-bottom: 1px solid rgba(255,255,255,0.1); 
        }
        
        .grid-title { 
            font-size: 20px; 
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
        }
        
        .grid-subtitle {
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Grid Buttons - iOS PILL STYLE */
        .button-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 12px; 
        }
        
        .grid-btn { 
            aspect-ratio: 1;
            background: #000;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            color: #fff;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px 8px;
            gap: 8px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .grid-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, rgba(255,255,255,0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .grid-btn:active { 
            transform: scale(0.95); 
            background: rgba(255,255,255,0.05); 
        }
        
        .grid-btn.selected { 
            background: #fff; 
            color: #000; 
            border-color: #fff; 
        }
        
        .grid-btn.locked {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .btn-icon { 
            font-size: 32px; 
        }
        
        .btn-desc {
            font-size: 9px;
            color: rgba(255,255,255,0.5);
            margin-top: 2px;
        }
        
        .grid-btn.selected .btn-desc {
            color: rgba(0,0,0,0.5);
        }
        
        /* Bottom Bar - MODE BUTTONS */
        .bottom-bar { 
            position: fixed; 
            bottom: 60px; 
            left: 0; 
            right: 0; 
            background: #000; 
            border-top: 1px solid rgba(255,255,255,0.1); 
            z-index: 900; 
            padding: 12px 10px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 6px; 
            flex-wrap: wrap; 
        }
        
        .mode-btn {
            background: #000;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 25px;
            padding: 8px 16px;
            color: #fff;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
        }
        
        .mode-btn:active { 
            transform: scale(0.95); 
        }
        
        .mode-btn.active { 
            background: #fff; 
            color: #000; 
            border-color: #fff; 
        }
        
        .money-btn {
            background: #000;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            padding: 8px 14px;
            color: #fff;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 45px;
        }
        
        .money-btn:active { 
            transform: scale(0.95); 
        }
        
        .money-btn.pulse {
            animation: moneyPulse 0.5s;
        }
        
        @keyframes moneyPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); border-color: #fff; }
        }
        
        /* Bottom Drawer - SWIPEABLE */
        .bottom-drawer { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            height: 60px; 
            background: #000; 
            border-top: 1px solid rgba(255,255,255,0.2); 
            z-index: 850; 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
        }
        
        .bottom-drawer.expanded {
            height: 180px;
            transform: translateY(-120px);
        }
        
        .drawer-handle {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 30px;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .drawer-handle::before {
            content: '';
            width: 30px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }
        
        .drawer-content {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .drawer-label { 
            padding: 8px 15px; 
            font-size: 9px; 
            color: rgba(255,255,255,0.5); 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            text-align: center;
        }
        
        .drawer-scroll { 
            flex: 1; 
            display: flex; 
            align-items: center; 
            padding: 0 15px; 
            gap: 10px; 
            overflow-x: auto; 
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .drawer-scroll::-webkit-scrollbar { 
            display: none; 
        }
        
        .drawer-item { 
            min-width: 60px; 
            height: 50px; 
            flex-shrink: 0; 
            background: #000; 
            border: 2px solid rgba(255,255,255,0.2); 
            border-radius: 12px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            gap: 2px; 
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .drawer-item:active {
            transform: scale(0.95);
        }
        
        .drawer-item.selected { 
            border-color: #fff; 
            background: rgba(255,255,255,0.05); 
        }
        
        .drawer-emoji { 
            font-size: 24px; 
        }
        
        .drawer-label-text { 
            font-size: 8px; 
            font-weight: 600; 
            text-transform: uppercase; 
            color: rgba(255,255,255,0.7); 
        }
        
        /* Shoot Button - GREEN TOP RIGHT */
        .shoot-btn { 
            position: fixed; 
            top: 70px; 
            right: 15px; 
            width: 56px; 
            height: 56px; 
            background: #00ff88; 
            border: none; 
            border-radius: 50%; 
            font-size: 28px; 
            cursor: pointer; 
            z-index: 9000; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: #000; 
            box-shadow: 0 4px 20px rgba(0,255,136,0.4); 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .shoot-btn:active { 
            transform: scale(0.9); 
            box-shadow: 0 2px 10px rgba(0,255,136,0.6);
        }
        
        .shoot-btn.shooting {
            animation: shootPulse 0.5s;
        }
        
        @keyframes shootPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); box-shadow: 0 4px 30px rgba(0,255,136,0.8); }
            100% { transform: scale(1); }
        }
        
        /* Control Knobs Panel */
        .knobs-panel {
            position: fixed;
            left: -250px;
            top: 50%;
            transform: translateY(-50%);
            width: 250px;
            background: #000;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 0 20px 20px 0;
            padding: 20px;
            z-index: 8000;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .knobs-panel.active {
            left: 0;
        }
        
        .knob-control {
            margin-bottom: 20px;
        }
        
        .knob-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .knob-value {
            color: #fff;
            font-weight: 600;
        }
        
        .knob-slider {
            height: 32px;
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }
        
        .knob-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: #fff;
            border-radius: 16px;
            width: 50%;
            transition: width 0.2s;
        }
        
        .knob-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            background: #fff;
            border: 2px solid #000;
            border-radius: 50%;
            left: 50%;
        }
        
        /* Particles */
        .particle {
            position: fixed;
            pointer-events: none;
            z-index: 10000;
            animation: particleFloat 2s ease-out forwards;
        }
        
        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--dx), -200px) scale(1.5);
            }
        }
        
        /* Pin Markers */
        .pin-marker {
            position: absolute;
            width: 30px;
            height: 40px;
            cursor: pointer;
            z-index: 500;
            transform-origin: bottom center;
            animation: pinDrop 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .pin-marker::before {
            content: '📍';
            font-size: 30px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        
        @keyframes pinDrop {
            0% { transform: translateY(-100px) scale(0.5); opacity: 0; }
            50% { transform: translateY(10px) scale(1.1); }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        /* Toast Notifications */
        .toast { 
            position: fixed; 
            top: 70px; 
            left: 50%; 
            transform: translateX(-50%) translateY(-20px); 
            background: #000; 
            border: 1px solid rgba(255,255,255,0.3); 
            color: #fff; 
            padding: 12px 24px; 
            border-radius: 25px; 
            font-size: 12px; 
            font-weight: 600; 
            z-index: 20000; 
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        
        .toast.active { 
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 30000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
            transition: opacity 0.5s;
        }
        
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: rgba(255,255,255,0.7);
        }
        
        /* Responsive */
        @media (max-width: 768px) { 
            .button-grid { 
                grid-template-columns: repeat(3, 1fr); 
            } 
        }
        
        @media (max-width: 480px) { 
            .button-grid { 
                grid-template-columns: repeat(2, 1fr); 
            }
            
            .mode-btn {
                padding: 6px 12px;
                font-size: 10px;
            }
            
            .money-btn {
                padding: 6px 10px;
                font-size: 10px;
            }
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">LOADING LEGENDARY</div>
    </div>
    
    <!-- Blueprint Background -->
    <div class="blueprint-bg"></div>
    
    <!-- Header -->
    <div class="header">
        <div class="logo">SOUND FACTORY</div>
        <div class="header-stats">
            <div>👥 <span id="onlineCount">247</span></div>
            <div>📍 <span id="pinCount">0</span>/3</div>
            <div>💰 $<span id="totalMoney">0</span></div>
        </div>
    </div>
    
    <!-- Blueprint Area -->
    <div class="blueprint-area" id="blueprintArea">
        <svg viewBox="0 0 400 520">
            <rect width="400" height="520" fill="none" stroke="rgba(255,255,255,0.15)" stroke-width="2"/>
            <rect x="30" y="30" width="340" height="460" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="1.5"/>
            <text x="200" y="25" font-size="11" fill="rgba(255,255,255,0.5)" text-anchor="middle">MAIN FLOOR</text>
        </svg>
        <div class="character" id="character">YOU</div>
    </div>
    
    <!-- 3 Floating + Buttons -->
    <div class="plus-btn" id="topBtn">+</div>
    <div class="plus-btn" id="middleBtn">+</div>
    <div class="plus-btn" id="bottomBtn">+</div>
    
    <!-- Shoot Button -->
    <button class="shoot-btn" id="shootBtn">🚀</button>
    
    <!-- Control Knobs Panel -->
    <div class="knobs-panel" id="knobsPanel">
        <div class="knob-control">
            <div class="knob-label">
                <span>SPEED</span>
                <span class="knob-value" id="speedValue">50%</span>
            </div>
            <div class="knob-slider" id="speedSlider">
                <div class="knob-fill" style="width: 50%"></div>
                <div class="knob-handle" style="left: 50%"></div>
            </div>
        </div>
        <div class="knob-control">
            <div class="knob-label">
                <span>POSITION</span>
                <span class="knob-value" id="positionValue">50%</span>
            </div>
            <div class="knob-slider" id="positionSlider">
                <div class="knob-fill" style="width: 50%"></div>
                <div class="knob-handle" style="left: 50%"></div>
            </div>
        </div>
        <div class="knob-control">
            <div class="knob-label">
                <span>INTENSITY</span>
                <span class="knob-value" id="intensityValue">50%</span>
            </div>
            <div class="knob-slider" id="intensitySlider">
                <div class="knob-fill" style="width: 50%"></div>
                <div class="knob-handle" style="left: 50%"></div>
            </div>
        </div>
        <div class="knob-control">
            <div class="knob-label">
                <span>SPREAD</span>
                <span class="knob-value" id="spreadValue">50%</span>
            </div>
            <div class="knob-slider" id="spreadSlider">
                <div class="knob-fill" style="width: 50%"></div>
                <div class="knob-handle" style="left: 50%"></div>
            </div>
        </div>
    </div>
    
    <!-- Grid Overlays Container -->
    <div id="gridContainer"></div>
    
    <!-- Bottom Drawer -->
    <div class="bottom-drawer" id="bottomDrawer">
        <div class="drawer-handle" id="drawerHandle"></div>
        <div class="drawer-content">
            <div class="drawer-label">SWIPE REACTIONS</div>
            <div class="drawer-scroll" id="drawerScroll"></div>
        </div>
    </div>
    
    <!-- Bottom Bar -->
    <div class="bottom-bar">
        <button class="mode-btn" id="socialMode">SOCIAL</button>
        <button class="mode-btn active" id="reactionsMode">REACTIONS</button>
        <button class="mode-btn" id="effectsMode">EFFECTS</button>
        <button class="mode-btn" id="aiMode">AI CHAIN</button>
        <button class="mode-btn" id="pinMode">DROP PIN</button>
        <button class="money-btn" data-amount="1">$1</button>
        <button class="money-btn" data-amount="5">$5</button>
        <button class="money-btn" data-amount="10">$10</button>
        <button class="money-btn" data-amount="20">$20</button>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>
    
    <script src="system.js"></script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('ServiceWorker registered:', registration);
                }).catch(err => {
                    console.log('ServiceWorker registration failed:', err);
                });
            });
        }
    </script>
</body>
</html>